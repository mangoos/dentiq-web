<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="robots" content="index, follow">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="author" content="https://github.com/aaa/">
    <title>덴탈플러스</title>
    <link href="css/fontawesome/css/fontawesome-all.css" rel="stylesheet"> <!-- font awesome 5.* pro -->
    <link rel="stylesheet" href="css/dentalBasic.css">

    <script src="js/jquery-1.12.4.min.js"></script>
    <script src="js/common.js"></script>
    <script src="js/handlebars.min.js"></script>
    <script src="js/util.js"></script>
    <script>
        function getValueString(valueStr) {
            if ( !valueStr ) return "";
            
            if ( typeof valueStr === 'string' ) return valueStr.trim();

            return valueStr;
        }
    </script>

</head>
<body>
    <header class="header-sub navbar">
        <section class="navbar-section">
            <span onclick="if(history.length>2){ history.back(); } else { location.href='liveboard.html'; }">
                <i class="fal fa-arrow-square-left"></i>
                이전페이지
            </span>
        </section>
        <section class="navbar-section">
            <a href="liveboard.html"><i class="fal fa-home"></i></a>
            <a href="user_panel.html"><i class="fal fa-user-alt"></i></a>
        </section>
    </header>
    <!-- loading spinner, 'active' 클래스로 활성화 -->
    <div class="dental-loading" id="loadingModal" hidden>
        <div class="fa-icon"><i class="fa fa-spinner fa-pulse fa-2x fa-fw"></i></div>
        <div class="loading-overlay" hidden></div>
    </div>

    <!--================================================================================================-->
    <!--                                                                                                -->
    <!--                                         주소 모달                                               -->
    <!--                                                                                                -->
    <!--================================================================================================-->
    <div class="juso-search-wrapper" id="jusoModal">
        <input class="juso-search-checkbox" type="checkbox" id="jusoSearchCheckbox" name="juso-search-checkbox" hidden><!-- 모달 체크박스 -->
        <!-- 배경, 체크박스로 하면 배경을 레이블로 해서 모달 죽일 수 있음-->
        <!-- <label for="jusoSearchCheckbox"><div class="dental-modal-overlay"></div></label>  -->
        <div class="juso-search">
            <div class="juso-search-header">
                <div class="juso-search-header-title">주소 검색</div>
                <div class="juso-search-header-desc">예시에 따라 검색하면 빠르게 찾을 수 있습니다.</div>
                <label class="juso-search-close-label" for="jusoSearchCheckbox" rel="juso-search" title="닫기"><i class="fa fa-window-close"></i></label>
            </div>
            <div class="juso-search-body address_search">
                <form id="jusoSearchForm">  <!-- 주소검색 Form -->
                    <div class="form-group">
                        <input type="text" class="styled-input" name="keyword" id="jusoSearchInput" maxlength="40" placeholder="예) 판교역로 235, 운중 산운마을" required>
                        <!-- <label class="styled-label">주소</label> -->
                        <!-- <span class="form-group-desc">정확하게 입력</span> -->
                        <!-- <span class="form-group-icon" hidden><i class="fal fa-check-circle"></i></span> -->
                        <span class="form-group-btn"><button type="submit" class="btn btn-primary">검색</button></span>
                        <span class="form-group-underline"></span>
                        <!-- <div class="form-group-msg2" hidden></div> -->
                    </div>
                </form>
                <div class="adderss-search-tip on" id="addrTip" hidden> 
                    <div class="info_body">
                        <p class="tit_tip">tip</p>
                        <p class="desc_tip">아래와 같은 조합으로 검색을 하시면 더욱 정확한 결과가 검색됩니다.</p>
                        <p class="desc_tip">도로명 + 건물번호</p>
                        <span class="txt_example">예) 판교역로 235, 제주 첨단로 242</span>
                        <p class="desc_tip2">지역명(동/리) + 번지</p>
                        <span class="txt_example">예) 삼평동 681, 제주 영평동 2181</span>
                        <p class="desc_tip2">지역명(동/리) + 건물명(아파트명)</p>
                        <span class="txt_example">예) 분당 주공, 연수동 주공3차</span>
                        <p class="desc_tip2">사서함명 + 번호</p>
                        <span class="txt_example">예) 분당우체국사서함 1~100</span>
                    </div>
                </div>
                <div class="address-search-result" id="addrResult" hidden>
                    <p class="result-amount">총 <strong id="totalCount">0</strong>건</p>
                    <ul id="jusoList" class="result-list"></ul>
                    <script id="jusoListTemplate" type="text/x-handlebars-template">
                        {{#each .}}
                        <li data-juso-idx="{{jusoIdx}}">
                            <div class="address-item road-name"><span>도로명</span><p>{{roadAddr}}</p></div>
                            <div class="address-item jibun"><span>지번</span><p>{{jibunAddr}}</p></div>
                            <div class="zip-code">{{zipNo}}</div>                                
                        </li>
                        {{/each}}
                    </script>
                </div>
            </div>
            <!-- <div class="juso-search-footer"></div> -->
        </div>
    </div>
    <script>
        // /**
        //  * 주소 모달 화면
        //  */
        // //var JusoModal = function(selectedJuso, funcAfterSelecting) {
        // //var JusoModal = function(funcAfterSelecting) {
		// var JUSO_MODAL =  (function() {

        //     var jusoSearchInput = document.getElementById("jusoSearchInput");

        //     var loadingModal = new LoadingModal(document.getElementById("loadingModal"));

        //     var JUSO_PER_PAGE = 10;         // 한번에 조회할 주소 아이템의 개수
        //     var SCROLL_LOCK = false;        // 주소 선택 영역 스크롤 락

        //     var lastPageNo = 1;             // 마지막 주소 아이템 페이지의 번호
        //     var lastJusoKeyword;            // 마지막 주소 검색 키워드 

        //     var totalJusoCount = 0;         // 검색된 주소 아이템의 개수
        //     var jusoContainer = {};         // 검색된 주소의 누적


        //     /******************************************************************************/
        //     /*  스크롤했을 때, 주소 아이템에 대한 append 처리
        //     /*  
        //     /*******************************************************************************/
        //     $("#jusoList").scroll(function() {
        //         //console.log(this);
                
        //         if ( totalJusoCount == 0 ) return;

        //         var maxPageNo = totalJusoCount / JUSO_PER_PAGE + 1;  // 한 페이지에 10개의 목록 지정 (개수 조정 시 변경 필요)
        //         if ( (lastPageNo+1) >= maxPageNo ) return;

        //         if ( SCROLL_LOCK ) {
        //             console.log("SCROLL : LOCKED" );
        //             setTimeout(function() {
        //                 SCROLL_LOCK = false;
        //                 console.log("SCROLL_LOCK 풀렸음");
        //             }, 500);
        //             return;
        //         }

        //         var element = document.getElementById("jusoList");
        //         console.log(element.scrollHeight, ", ", Math.ceil(element.scrollTop), ", ", element.scrollHeight - Math.ceil(element.scrollTop), ", ", element.clientHeight);
                
        //         if ( element.scrollHeight - Math.ceil(element.scrollTop) <= element.clientHeight ) {
        //             console.log("바닥");
        //             searchJuso(lastJusoKeyword, (lastPageNo+1));
        //         }
                
        //     });


        //     // 주소 모달 submit (검색 실행)
        //     $("#jusoSearchForm").submit(function(e) {
        //         e.preventDefault();
        //         lastJusoKeyword = $("#jusoSearchForm input[name=keyword]").val();
        //         lastPageNo = 1;         // 초기화
        //         jusoContainer = {};     // 초기화
        //         selectedJuso = null;    // 초기화
		// 		$("#jusoList").html('');
				
		// 		// if ( !checkSearchedWord(lastJusoKeyword) ) {
		// 		// 	return;
		// 		// }

        //         searchJuso(lastJusoKeyword, 1);
        //     });



        //     // 지역코드 - 시도 선택 템플릿 객체
        //     var jusoListTemplate = $("#jusoListTemplate").html();

        //     // 주소 모달에서 주소 검색 실행
        //     function searchJuso(keyword, currentPage) {

        //         if ( SCROLL_LOCK ) {
        //             console.log("SCROLL LOCKED - in JS");
        //             setTimeout(function() {
        //                 SCROLL_LOCK = false;
        //                 console.log("listJobAds:SCROLL_LOCK 풀렸음");
        //             }, 500);
        //             return;
        //         }
        //         SCROLL_LOCK = true;

        //         var apiParam = "keyword=" + keyword;
        //         if ( currentPage!=null ) apiParam += "&currentPage=" + currentPage;

        //         // LOADING 표시 - 시작
        //         loadingModal.open();
                

        //         callApi("GET", "/api/location/", apiParam, 
        //             function(resData) {
        //                 var errorCode = resData.common.errorCode;
        //                 if ( errorCode!="0" && errorCode!="00" ) {
		// 					// 에러 팝업 띄울 것
		// 					if ( resData.common.errorMessage ) {
		// 						dModal.alert(resData.common.errorMessage + "  \n[" + errorCode + "]");
		// 					} else {
		// 						dModal.alert("주소 검색에 실패했습니다. [" + errorCode + "]");
		// 					}
        //                     _resetJusoModal();
        //                     loadingModal.close(); // LOADING 표시 - 끝
        //                     return;
        //                 }

        //                 console.log("주소 처리 시작 : 수신 데이터 : ", resData.juso);
                        
        //                 totalJusoCount = resData.common.totalCount;  
                      
        //                 if ( totalJusoCount === "0" ) {
        //                     dModal.alert("검색 결과가 없습니다. \n 팁을 참고해서 다른 키워드로 검색해 보세요.", function() {
        //                         jusoSearchInput.focus();
        //                     });
        //                     _resetJusoModal();
        //                     loadingModal.close();
        //                     return;
        //                 }

        //                 if ( currentPage != null ) lastPageNo = currentPage;
                        
        //                 resData.locationList.forEach(function(jusoItem) {
        //                     jusoContainer[jusoItem.jusoIdx] = jusoItem;
        //                     console.log("데이터 세팅 결과 : ", jusoContainer[jusoItem.jusoIdx]);
        //                     console.log("\t\t!!!! 현재까지의 jusoContainer : ", jusoContainer);
        //                 });
                        
        //                 var jusoListContent = Handlebars.compile(jusoListTemplate)(resData.locationList);

        //                 if ( currentPage != null && currentPage > 1 ) {
        //                     $("#jusoList").append(jusoListContent);
        //                 } else {
        //                     $("#jusoList").html(jusoListContent);
        //                 }

        //                 $("#totalCount").html(totalJusoCount);
        //                 //console.log(jusoList);

        //                 SCROLL_LOCK = false;
        //                 loadingModal.close(); // LOADING 표시 - 끝
        //                 if( addrTip.classList.contains("on") ) { addrTip.classList.remove("on"); } // 선정우가 한땀, 주소 검색 팁박스 hidden 처리
        //                 if( !addrResult.classList.contains("on") ) { addrResult.classList.add("on"); } // 선정우가 한땀, 주소 검색 결과 박스 on 처리
        //                 console.log("현재까지의 jusoContainer : ", jusoContainer);
        //             },
        //             function(errorCode, errorMsg) {
        //                 dModal.alert("에러 [" + errorCode + "] ==> [" + errorMsg + "]");
        //                 SCROLL_LOCK = false;
        //                 loadingModal.close(); // LOADING 표시 - 끝
        //             }
        //         );
        //     }

        //     // 주소모달을 Open한다.
        //     function _openJusoModal() {
        //         document.getElementById("jusoSearchCheckbox").checked = true;
        //     }
            
        //     // 주소모달을 close한다.
        //     function _closeJusoModal() {
        //         document.getElementById("jusoSearchCheckbox").checked = false;
        //     }

        //     function _resetJusoModal() {
        //         // 주소 검색 요소 초기화
        //         SCROLL_LOCK = false;
        //         addrTip.classList.add("on");
        //         addrResult.classList.remove("on");
        //         jusoList.innerHTML = "";
        //         jusoSearchInput.value = "";
        //     }


        //     // 주소 모달에서 주소 선택했을 때, 부모 화면에 주소 값을 세팅해주고, 자신은 close.
        //     $("#jusoList").on("click", "li", function() {
        //         var jusoIdx = $(this).attr("data-juso-idx");

        //         console.log("선택된 주소 ", jusoContainer[jusoIdx]);
        //         if ( !jusoContainer[jusoIdx] ) {
        //             console.log("ERROR : jusoContainer의 값이 없음");
        //             return;
        //         }

        //         // 1. 좌표 검색 수행
        //         //getCoordiate(jusoContainer[jusoIdx]);
        //         var coordinateParam = convertObjectToFormDataString(jusoContainer[jusoIdx]);
        //         console.log("보낼 데이터 ", coordinateParam);

        //         callApi("GET", "/api/coordinate/", coordinateParam, 
        //             function(resData) {
        //                 console.log(resData);

        //                 jusoContainer[jusoIdx].entX          =   resData[0].entX;           // 출입구 X좌표
        //                 jusoContainer[jusoIdx].entY          =   resData[0].entY;           // 출입구 X좌표
        //                 console.log("주소 & 좌표 검색 완료 : ", jusoContainer[jusoIdx]);

        //                 _closeJusoModal();              // 자신을 닫기

        //                 funcAfterSelecting(jusoContainer[jusoIdx]);     // 추가 Callback 함수 실행
        //             },
        //             function(errorCode, errorMsg) {
        //                 alert("에러 [" + errorCode + "] ==> [" + errorMsg + "]");
        //             }
        //         );
                
		// 	});
			

        //     return {
        //         closeJusoModal : function() {
        //             _closeJusoModal();
        //             _resetJusoModal();
        //         },
        //         openJusoModal : function(e) {
        //             if(e) {
        //                 e.preventDefault();
        //                 // dModal.instant(e.target); 
        //                 e.target.blur();
        //             }
        //             _resetJusoModal();
        //             _openJusoModal();
        //             jusoSearchInput.focus();
		// 		},
		// 		setFuncAfterSelecting: function(_funcAfterSelecting) {
		// 			funcAfterSelecting = _funcAfterSelecting;
		// 		}
        //     };
        // })();
    
    </script>
    <!--================================================================================================-->
    <!--                                    주소 모달 종료                                               -->
    <!--================================================================================================-->
    
    
        
    <section class="dental-steps register-user" id="registerUserSteps">
        <input type="radio" name="steps" id="tabLocal" checked hidden>
        <input type="radio" name="steps" id="tabHome" hidden>
        <input type="radio" name="steps" id="tabBasic" hidden>
        <input type="radio" name="steps" id="tabFinal" hidden>
        
        <div class="step step-nav" id="tabNav" style="display: none">
            <label class="step-item" for="tabLocal"><span>관심지역</span></label>
            <label class="step-item" for="tabHome"><span>우리동네</span></label>
            <label class="step-item" for="tabBasic"><span>기본정보</span></label>
            <label class="step-item" for="tabFinal"><span>완료</span></label>
        </div>
        <script>
            // 탭을 클릭할 때, 각 탭에 대한 Javascript App을 실행한다.

            document.getElementById("tabLocal").addEventListener("change", function(event) {
                InterestingLocationApp.init();
            });
            document.getElementById("tabHome").addEventListener("change", function(event) {
                MyHomeApp.init();
            });
            document.getElementById("tabBasic").addEventListener("change", function(event) {
                MyInfoApp.init();
            });
            
            
        </script>
        <script>
            var SPECIFIC_TAB_MODE = false;
            function loadSpecificTabOnly() {
    
                // HTTP GET Query 문자열에서 특정 파라미터가 포함되어 있는지 확인한다. copy from liveboard.html
                function containsParamInParamString(paramString, paramToBeSearch) {
                    if ( !paramString ) return false;
    
                    var tokens = paramString.split("&");
                    for ( var i=0; tokens && i<tokens.length; i++ ) {
                        var paramName = tokens[i].split("=")[0];
                        if ( paramName == paramToBeSearch ) return true;
                    }
    
                    return false;
                }

                var htmlCallParamString = getHtmlCallParamString();

                if ( htmlCallParamString && containsParamInParamString(htmlCallParamString, "LOCAL") ) {
                    console.log("관심지역 탭");
                    document.getElementById("tabNav").style.display = 'none';
                    document.getElementById("tabLocal").checked = true;
                    document.getElementById("tabLocal").dispatchEvent(new CustomEvent("change"));
                    SPECIFIC_TAB_MODE = true;

                } else if ( htmlCallParamString && containsParamInParamString(htmlCallParamString, "HOME") ) {
                    console.log("우리동네");
                    document.getElementById("tabNav").style.display = 'none';
                    document.getElementById("tabHome").checked = true;
                    document.getElementById("tabHome").dispatchEvent(new CustomEvent("change"));
                    SPECIFIC_TAB_MODE = true;
    
                } else if ( htmlCallParamString && containsParamInParamString(htmlCallParamString, "BASIC") ) {
                    console.log("기본정보");
                    document.getElementById("tabNav").style.display = 'none';
                    document.getElementById("tabBasic").checked = true;
                    document.getElementById("tabBasic").dispatchEvent(new CustomEvent("change"));
                    SPECIFIC_TAB_MODE = true;

                } else {
                    console.log("다중 탭 모드 ", htmlCallParamString);
                    document.getElementById("tabNav").style.display = 'flex';
                    document.getElementById("tabLocal").checked = true;  // 관심지역 탭을 클릭함
                    document.getElementById("tabLocal").dispatchEvent(new CustomEvent("change"));
                    SPECIFIC_TAB_MODE = false;
                    
                }
            }

            window.onload = function() {
                loadSpecificTabOnly();
            }
    
        </script>


        <div class="step-body">
            


            <!--================================================================================================-->
            <!--                                                                                                -->
            <!--                                             관심지역                                            -->
            <!--                                                                                                -->
            <!--================================================================================================-->
            <div class="step-content dental-tabs" hidden>
                <div class="step-content-header">
                    <div class="content-title"><i class="fas fa-thumbtack" style="transform: rotate(45deg);"></i>관심지역</div>
                    <div class="content-desc">병원/채용정보를 쉽고 편하게 볼 수 있어요.</div>
                    <div class="content-desc">최대 6개까지 설정 가능.</div>
                </div>
                <form id="interestingLocationForm">
                    <input class="tabs-input" type="radio" name="tabs" id="tab-sido" checked hidden>
                    <input class="tabs-input" type="radio" name="tabs" id="tab-sigu" hidden disabled>
                    <div class="dental-tabs-header flex-wrap" id="selectedSiguChips" style="border-bottom: none; margin-bottom: 0;"></div>
                    <script id="selectedSiguChipsTemplate" type="text/x-handlebars-template">
                        {{#each .}}
                            <!--
                            <label class="chip" for="location-{{locationCode}}" style="display: none;"><span>{{sidoName}}</span><span>전체</span><span class="btn btn-clear"></span></label>
                            -->
                            {{#each this.children}}
                            <label class="chip" for="location-{{locationCode}}" style="display: none;"><span>{{sidoName}}</span><span>{{siguName}}</span><span class="btn btn-clear"></span></label>
                            {{/each}}
                        {{/each}}
                    </script>
                    <!-- <div class="divider"></div> -->
                    <div class="tab tab-block">
                        <label class="tab-item" for="tab-sido"><span>시/도 선택</span></label>
                        <label class="tab-item" for="tab-sigu"><span>시/구/군 선택</span></label>
                    </div>
                    

                    <!-- 특정 시도 전체 및 특정 시구를 선택하기 위한 checkbox 영역 -->
                    <div class="tab-body" id="locationSelect"></div>
                    <script id="locationSelectTemplate" type="text/x-handlebars-template">
                                            
                        {{#each .}}
                        <input type="radio" name="sido" id="sido-{{locationCode}}" hidden>
                        {{/each}}
                        <div class="tab-content cfixed" data-tag="tab-sido">
                            {{#each .}}
                            <label class="chip" for="sido-{{locationCode}}"><span>{{sidoName}}</span></label>
                            {{/each}}
                        </div> 
                        

                        <div class="tab-content" data-tag="tab-sigu">
                        <!-- <div class="tab-content" id="siguSelect"> -->
                            {{#each .}}
                                <div class="tab-sub">
                                    <!--
                                    <label><input type="checkbox" id="location-{{locationCode}}" name="locationCode" value="{{locationCode}}" data-sido-code="{{sidoCode}}" hidden><span class="chip">전체</span></label>
                                    -->
                                    {{#each this.children}}
                                    <label><input type="checkbox" id="location-{{locationCode}}" name="locationCode" value="{{locationCode}}" data-sido-code="{{sidoCode}}" hidden><span class="chip">{{siguName}}</span></label>
                                    {{/each}}
                                </div>
                            {{/each}}
                        </div>
                    </script>


                    <!-- 선택된 지역코드(특정 시도 전체 + 특정 시구)에 대한 chip 표시 영역 -->
                    <!-- <div class="tab-footer" id="selectedSiguChips"></div>
                    <script id="selectedSiguChipsTemplate" type="text/x-handlebars-template"> -->
                        <!-- {{#each .}} -->
                            <!--
                            <label class="chip" for="location-{{locationCode}}" style="display: none;"><span>{{sidoName}}</span><span>전체</span><span class="btn btn-clear"></span></label>
                            -->
                            <!-- {{#each this.children}}
                            <label class="chip" for="location-{{locationCode}}" style="display: none;"><span>{{sidoName}}</span><span>{{siguName}}</span><span class="btn btn-clear"></span></label>
                            {{/each}}
                        {{/each}}
                    </script> -->



                    <div class="fixed-layer-btm">
                        <button class="fixed-layer-btm-pass" type="button">나중에 할께요</button>
                        <button class="fixed-layer-btm-confirm" type="submit">등록</button>
                    </div>
                </form>
            
            </div>
            <script>
                /******************************************************************************/
                /*  관심지역 
                /*******************************************************************************/
                var InterestingLocationApp = (function() {

                    // 지역코드 - 시구선택 영역
                    var locationSelectTemplate = $("#locationSelectTemplate").html();
                    var locationSelectContents = Handlebars.compile(locationSelectTemplate)(LOCATION_CODE.listSidoCode());
                    $("#locationSelect").html(locationSelectContents);

                    // 지역코드 - 시구선택 칩 템플릿
                    var selectedSiguChipsTemplate = $("#selectedSiguChipsTemplate").html();
                    var selectedSiguChipsContents = Handlebars.compile(selectedSiguChipsTemplate)(LOCATION_CODE.listSidoCode());
                    $("#selectedSiguChips").html(selectedSiguChipsContents);


                    // //bindCheckboxesWithResetByName(document.getElementById("interestingLocationForm"), "siguCode");


                    // 시도-시구 탭 이동 이벤트 핸들러
                    $("#locationSelect").on("click", "input[name=sido]", function() {
                        console.log(this);
                        // $("#tab-sido").prop("checked", "false");
                        $("#tab-sigu").prop("checked", "true");
                    });



                    function processCheckboxEvent1(event) {
                        console.log("*** 시구코드 선택 : ", this.value, ", ", this.checked);

                        var currentSidoCode = this.dataset.sidoCode;


                        if ( currentSidoCode == this.value && this.checked ) {  // 이것은 '전체'
                            document.querySelectorAll("input[type=checkbox][name='locationCode'][data-sido-code='" + currentSidoCode + "']:not([value='" + currentSidoCode + "'])").forEach(function(element) {
                                element.checked = false;
                            });

						} else {    // 이것은 '시구'

							if ( document.querySelectorAll("input[type=checkbox][name='locationCode']:checked").length > 6 ) {
								this.checked = false;
								dModal.alert("관심지역은 최대 6개까지 설정 가능합니다.");
								return;
							}

                            // 동일 시도 내의 체크된 개수 ('전체' 불포함)
                            var checkedCnt      = document.querySelectorAll("input[type=checkbox][name='locationCode'][data-sido-code='" + currentSidoCode + "']:not([value='" + currentSidoCode + "']):checked").length;

                            // 동일 시도 내의 모든 시구 개수 ('전체' 불포함)
                            var siguCheckboxes  = document.querySelectorAll("input[type=checkbox][name='locationCode'][data-sido-code='" + currentSidoCode + "']:not([value='" + currentSidoCode + "'])");
                            

                            if ( siguCheckboxes.length==checkedCnt ) {   // '시구'가 모두 선택된 상태

                                // 2018.03.29 이주현 수정. '전체' 선택 기능을 제거
                                // '전체'를 check
                                // console.log("currentSidoCode ", currentSidoCode );
                                // document.querySelector("input[type=checkbox][name='locationCode'][value='" + currentSidoCode + "'][data-sido-code='" + currentSidoCode + "']").checked = true;

                                // // 모든 '시구'를 uncheck
                                // siguCheckboxes.forEach(function(element) {
                                //     element.checked = false;
                                // });

                            } else if ( siguCheckboxes.length > 0 ) {  // 하나라도 선택된 상태
                                // '전체'를 uncheck
                                //document.querySelector("input[type=checkbox][name='locationCode'][value='" + currentSidoCode + "'][data-sido-code='" + currentSidoCode + "']").checked = false;
                            }

                        }
                        renderSelectedLocationChips();
                    }

                    function renderSelectedLocationChips() {
                        document.querySelectorAll("input[type=checkbox][name='locationCode']").forEach(function(element) {
                            var checkboxId = "location-" + element.value;
                            if ( element.checked ) {
                                $(".chip[for='" + checkboxId + "']").show();
                            } else {
                                $(".chip[for='" + checkboxId + "']").hide();
                            }
                        });
                    }

                    function processCheckboxEvent2(event) {
                        console.log("*** 칩 변경 이벤트 ", this, " ===> ", this.checked);
                        // A. 칩 보이기/숨기기 처리
                        if (this.checked == true) {
                            $(".chip[for='" + this.id + "']").show();
                        } else {
                            $(".chip[for='" + this.id + "']").hide();
                        }
                    }
                    
                    $("[name='locationCode']").each(function(idx, element) {  // explore 에서는 HTMLCollection 을 리턴, 표준에서는 NodeList ㅠ
                        element.addEventListener("change", processCheckboxEvent1);
                        //element.addEventListener("change", processCheckboxEvent2);
                    });



                    // 이미 관심지역을 선택한 내역이 있으면, 화면에 렌더링
                    function loadInterestingLocation() {

                        var userId = LOGIN_INFO.getId();
                        if ( userId == null ) {
                            alert("로그인 되어 있지 않습니다. ");
                            return;
                        }

                        callApi("GET", "/api/user/"+userId+"/interestLocationCode/", null, 
                            function(resData) {
                                resData.forEach(function(locationCode) {
                                    console.log("로딩됨 ", locationCode);
                                    //console.log(item.siguCode);
                                    document.getElementById("location-"+locationCode).checked = true;      // 시구 선택 check
                                    //$(".chip[for='location-"+item.siguCode+"']").show();                    // 선택된 시구에 대한 chip 표시
                                    renderSelectedLocationChips();
                                });
                            },
                            function(errorCode, errorMsg) {
                                alert("에러 [" + errorCode + "] ==> [" + errorMsg + "]");
                            }
                        );
                    }


                    // 관심 지역 등록
                    $("#interestingLocationForm").submit(function(e) {
                        e.preventDefault();
                        console.log($("#interestingLocationForm").serialize() );

                        var userId = LOGIN_INFO.getId();
                        var apiParam = $("#interestingLocationForm").serialize();
                        callApi("PUT", "/api/user/"+userId+"/interestLocationCode/", apiParam,
                            function(resData) {
                                console.log(resData);
                                dModal.alert("내 관심 지역을 등록했습니다.");

                                // 등록 완료 후 이동.
                                if ( SPECIFIC_TAB_MODE ) {
                                    window.history.back();
                                } else {
                                    document.getElementById("tabHome").checked = true;
                                    document.getElementById("tabHome").dispatchEvent(new CustomEvent("change"));
                                }

                            },
                            function(errorCode, errorMsg) {
                                alert("에러 [" + errorCode + "] ==> [" + errorMsg + "]");
                            }
                        );
                    });


                    // return {
                    //     test: function() {
                    //         loadInterestingLocation();
                    //     }
                    // }

                    //loadInterestingLocation();
                    return {
                        init: function() {
                            loadInterestingLocation();
                        }
                    }

                })();            
            </script>




            <!--================================================================================================-->
            <!--                                                                                                -->
            <!--                                             우리동네                                            -->
            <!--                                                                                                -->
            <!--================================================================================================-->
            <div class="step-content" hidden>
                <div class="step-content-header">
                    <div class="content-title"><i class="fa fa-thumb-tack"></i>우리동네</div>
                    <div class="content-desc">우리집 주변 실시간 병원, 채용 정보 업데이트.</div>
                    <div class="content-desc">주소만 설정하면 끝!</div>
                </div>
                <form id="jusoForm">
                    <div class="dental-card address_search">
                        <div class="dental-card-header"><div class="dental-card-header-title h4">주소 검색</div></div>
                        <div class="card-body">
                            <div class="form-group">
                                <input type="text" class="styled-input call-juso-search" maxlength="40" name="addrMain" id="addrMain" placeholder="주소 입력" readonly required>
                                <!-- <label class="styled-label hasValue">주소를 검색해 주세요</label> -->
                                <!-- <span class="form-group-desc">정확하게 입력</span> -->
                                <!-- <span class="form-group-icon" hidden><i class="fal fa-check-circle"></i></span> -->
                                <span class="form-group-underline"></span>
                                <!-- <div class="form-group-msg2" hidden></div> -->
                            </div>
                            <div class="form-group-linked">
                                <input class="styled-input" type="text" name="addrDetail" id="addrDetail" placeholder="상세주소" required>
                                <span class="form-group-underline"></span>
                            </div>
                        </div>
                    </div>
                    <div class="fixed-layer-btm">
                        <button class="fixed-layer-btm-pass" type="button">나중에 할께요</button>
                        <button class="fixed-layer-btm-confirm" type="submit">등록</button>
                    </div>
                </form>
            </div>
            
            <script>
                /******************************************************************************/
                /*  우리동네 - 집주소
                /*******************************************************************************/
                var MyHomeApp = (function() {
                
                    // var selectedJuso = null;
                
                    function loadMyHome() {
                        var userId = LOGIN_INFO.getId();
                        if ( userId == null ) {
                            alert("로그인되어 있지 않음");
                            return;
                        }
                
                        callApi("GET", "/api/user/"+userId+"/addr/", null, 
                            function(resData) {
                                console.log("사용자 주소 로드 : ", resData);
                                if ( resData==null ) return;        // 사용자의 주소가 없을 수도 있음.
                
                                selectedJuso = resData;
                
                                //$("#addrMain").html(selectedJuso.roadAddr);
                                document.getElementById("addrMain").value = selectedJuso.addrMain;          // 도로명주소(참고항목 제외) 
                                document.getElementById("addrDetail").value = selectedJuso.addrDetail;      // 상세주소
                
                            },
                            function(errorCode, errorMsg) {
                                alert("에러 [" + errorCode + "] ==> [" + errorMsg + "]");
                            }
                        );
                    }
                
                                        
                    /* 주소 등록 실행 : submit 전 check */
                    document.getElementById("jusoForm").addEventListener("submit", function(e) {
                    //$("#jusoForm").submit(function(e) {
                        e.preventDefault();
                
                        var addrDetail = $("#addrDetail").val().trim();
                
                        if ( addrDetail==null || addrDetail=="" ) {
                            dModal.alert("우리집 상세주소를 입력해주세요.");
                            $("#addrDetail").focus();
                            return;
                        }
                
                        if ( selectedJuso==null ) {
                            dModal.alert("우리집 주소를 선택해주세요");
                            return;
                        } 
                
                        selectedJuso.addrDetail = addrDetail;
                        console.log("현재 선택된 주소 ", selectedJuso);
                
                        registerAddr(selectedJuso);
                    });
                    /* 주소 등록 실행 */
                    function registerAddr(_selectedJuso) {      // JSON으로 송수신 함.
                        var userId = LOGIN_INFO.getId();

                        _selectedJuso.addrMain      = document.getElementById("addrMain").value.trim();
                        _selectedJuso.addrDetail    = document.getElementById("addrDetail").value.trim();

                        var apiParam = JSON.stringify(_selectedJuso);
                        
                        callApi("PUT", "/api/user/"+userId+"/addr/", apiParam,
                            function(resData) {
                                console.log(resData);
                                dModal.alert("우리집 주소를 등록했습니다.");

                                // 등록 완료 후 이동.
                                if ( SPECIFIC_TAB_MODE ) {
                                    window.history.back();
                                } else {
                                    document.getElementById("tabFinal").checked = true;
                                    document.getElementById("tabBasic").dispatchEvent(new CustomEvent("change"));
                                }
                            },
                            function(errorCode, errorMsg) {
                                alert("에러 [" + errorCode + "] ==> [" + errorMsg + "]");
                            },
                            "application/json"
                        );
                    }


                    // 주소 모달 바인딩
                    // var jusoModal = new JusoModal(function(newSelectedJuso) {
                        
                    //     selectedJuso = newSelectedJuso;
                    //     console.log(selectedJuso);
                                                
                    //     document.getElementById("addrMain").value = newSelectedJuso.roadAddrPart1;          // 주소 앞 부분 설정
                    //     console.log("주소 앞부분 [" + document.getElementById("addrMain").value + "]");                        
                        

                    //     document.getElementById("addrDetail").value = "";
                    //     document.getElementById("addrDetail").readOnly = false;
                    //     document.getElementById("addrDetail").focus();                                         // 포커스 이동
					// });
					


                    //console.log("TEST : 주소모달의 정체 ", jusoModal);

                    // 주소 모달 띄우기
                    // document.getElementById("addrMain").addEventListener("click", function(event) {
                    //     // this.disabled = true;

					// 	JUSO_MODAL.setFuncAfterSelecting(function(newSelectedJuso) {
                        
					// 		selectedJuso = newSelectedJuso;
					// 		console.log("우리동네 - 콜백으로 받은 주소 객체 : ", selectedJuso);
													
					// 		document.getElementById("addrMain").value = newSelectedJuso.roadAddrPart1;          // 주소 앞 부분 설정
					// 		console.log("우리동네 - 주소 앞부분 [" + document.getElementById("addrMain").value + "]");

					// 		document.getElementById("addrDetail").value = "";
					// 		document.getElementById("addrDetail").readOnly = false;
					// 		document.getElementById("addrDetail").focus();                                         // 포커스 이동
					// 	});
						
                    //     JUSO_MODAL.openJusoModal(event);
                    // });

                    return {
                        init: function() {
                            loadMyHome();
                        }
                    };
                })();
            
            </script>




            <!--================================================================================================-->
            <!--                                                                                                -->
            <!--                                             기본정보                                            -->
            <!--                                                                                                -->
            <!--================================================================================================-->                                  
            <div class="step-content" hidden>
                <form id="basicInfoForm">
                    <div class="step-content-header">
                        <div class="content-title"><i class="fa fa-thumb-tack"></i>내 기본정보</div>
                        <div class="content-desc">구직 활동을 위한 최소 기본 정보를 입력해 주세요.</div>
                        <div class="content-desc">지원한 병원의 담당자만 확인할 수 있습니다.</div> <!-- 개인 정보 관련 정책(프로세스, 커뮤니케이션) 협의 필요 -->
                        <div class="content-desc"> 덴탈 플러스 매칭 알고리즘을 통해 보다 정확한 인재 추천을 가능하게 합니다.</div>
                        <div class="content-desc"><i class="fal fa-check" style="color: red; margin-right: 0.5rem; margin-left: 0.5rem;"></i> 항목은 최소 필수 입력값입니다.</div>
                    </div>
                    <div class="basic-info-card dental-card">
                        <div class="form-group need-validator">
                            <input class="styled-input d-reg-name" type="text" name="name" placeholder="예) 김영희, 홍철수 등" required>
                            <label class="styled-label">이름</label>
                            <span class="form-group-desc">정확하게 입력해 주세요</span>
                            <!-- 아래 아이콘, form element가 focus 일때 활성화, :invalid 이면 붉은 아이콘, :valid 이면 파란색 아이콘 -->
                            <span class="form-group-icon" hidden><i class="fal fa-check-circle"></i></span>  
                            <span class="form-group-underline"></span> <!-- '.error' 상태일때 form element가 focus 상태이면 붉은 줄, 그외는 노란줄 -->
                            <div class="form-group-msg2" hidden>이름을 정확하게 입력해주세요.</div>
                        </div>
                        <div class="form-group need-validator">
                            <input class="styled-input d-reg-mobile" type="tel" name="telNo" id="basicInfoTelNo" maxlength ="12" placeholder="예) 01024538594" required>
                            <label class="styled-label">핸드폰번호</label>
                            <span class="form-group-desc">'-' 빼고 숫자만 입력</span>
                            <span class="form-group-icon" hidden><i class="fal fa-check-circle"></i></span>
                            <span class="form-group-underline"></span>
                            <div class="form-group-msg2" hidden>구인 제안을 받을 번호로 정확하게 입력해 주세요.</div>
                        </div>
                        <div class="form-group need-validator">
                            <input class="styled-input hasValue d-reg-email" type="email" id="myInfoEmail" placeholder="" readonly disabled required>
                            <label class="styled-label">이메일</label>
                            <span class="form-group-desc">가입한 아이디와 연동이 됩니다.</span>
                            <span class="form-group-icon" hidden><i class="fal fa-check-circle"></i></span>
                            <span class="form-group-underline"></span>
                            <div class="form-group-msg2" hidden></div>
                        </div>
                        <div class="form-group"> <!-- 앞에서 입력한 우리동네 주소를 가져온다? -->
                            <input class="styled-input call-juso-search" type="text" id="myInfoAddrMain" placeholder="이력서에 입력되는 기본 주소입니다." required>
                            <label class="styled-label">주소</label>
                            <span class="form-group-desc">정확하게 입력</span>
                            <span class="form-group-icon" hidden><i class="fal fa-check-circle"></i></span>
                            <span class="form-group-underline"></span>
                            <div class="form-group-msg2" hidden></div>
                        </div>
                        <div class="form-group-linked"> <!-- 바로 위 styled-form-group input 에 값 입력된 후에 enabled 처리 -->
                            <input class="styled-input" type="text" id="myInfoAddrDetail" placeholder="상세 주소입니다." required>
                            <span class="form-group-underline"></span>
                        </div>


                        <div class="form-group need-validator">
                            <input class="styled-input d-reg-date" type="text" name="birthday" placeholder=" 예) 19950427" required >
                            <label class="styled-label">생년월일</label>
                            <span class="form-group-icon" hidden><i class="fal fa-check-circle"></i></span>
                            <span class="form-group-underline"></span>
                            <div class="form-group-msg2" hidden>숫자로만 입력해주세요. 우측 성별 아이콘도 선택해주세요</div>
                            <span class="form-group-opt">
                                <label><input class="opt-btn-input" type="radio" name="gender" id="gender-F" value="F" hidden checked><i class="far fa-female"></i></label>
                                <label><input class="opt-btn-input" type="radio" name="gender" id="gender-M" value="M" hidden ><i class="far fa-male"></i></label>
                            </span>
                        </div>
                    </div>
                    <div class="fixed-layer-btm">
                        <button id="passRegisterBtn" class="fixed-layer-btm-pass" type="button">나중에 할께요</button>
                        <button class="fixed-layer-btm-confirm" type="submit">등록</button>
                    </div>
                </form>
            </div>

            <script>
                /******************************************************************************/
                /*  기본정보
                /*******************************************************************************/

                var MyInfoApp = (function() {
                    var basicInfoForm = document.getElementById("basicInfoForm");

					// var selectedJuso = null;
					
					//var oldJuso = null;

                    // 먼저 기본 정보를 불러온다.
                    function loadMyInfo() {                        
                        var userId = LOGIN_INFO.getId();
                        if ( userId == null ) {
                            alert("로그인되어 있지 않음");
                            return;
						}
						
						// 기본 정보 로드
                        callApi("GET", "/api/user/"+userId+"/basicInfo/", null, 
                            function(resData) {
								console.log(resData);
								
                                basicInfoForm.querySelector("input[name='name']").value         = getValueString(resData.name);
                                basicInfoForm.querySelector("input[name='telNo']").value        = getValueString(resData.telNo);
								document.getElementById("myInfoEmail").value                    = getValueString(resData.email);
								basicInfoForm.querySelector("input[name='birthday']").value     = getValueString(resData.birthday);

								var gender = getValueString(resData.gender);
                                if ( gender == 'M' ) document.getElementById("gender-M").checked = true;
								else if ( gender == 'F' ) document.getElementById("gender-F").checked = true;
								

								if ( resData.location ) {
									selectedJuso = resData.location;
									document.getElementById("myInfoAddrMain").value                 = getValueString(selectedJuso.addrMain);
									document.getElementById("myInfoAddrDetail").value               = getValueString(selectedJuso.addrDetail);
								}


                            },
                            function(errorCode, errorMsg) {
                                alert("에러 [" + errorCode + "] ==> [" + errorMsg + "]");
                            }
                        );
                        
                    }

                    
                    
                    function registerMyInfo(event) {
                        event.preventDefault();
                        var temp = $(basicInfoForm).serialize();
                        console.log(temp);

                        var userId = LOGIN_INFO.getId();
                        if ( userId == null ) {
                            alert("로그인되어 있지 않음");
                            return;
                        }

                        if ( selectedJuso==null ) {
                            dModal.alert("주소를 선택해주세요");
                            return;
                        }

                        var addrDetail = $("#myInfoAddrDetail").val().trim();                
                        if ( addrDetail==null || addrDetail=="" ) {
                            dModal.alert("'상세주소를 입력해주세요.");
                            $("#myInfoAddrDetail").focus();
                            return;
                        }


                        selectedJuso.addrDetail     = addrDetail;
                        selectedJuso.addrMain       = document.getElementById("myInfoAddrMain").value.trim();
                        
                        
                        // 기본 정보 업데이트
						var data = createObjectFromFormData(basicInfoForm);
						data.location = selectedJuso;
						data.userId = userId;
                        
                        console.log("++++++++++++++++++++++++++++++++++++data+++++++++++++++++++++++++", data);

						console.log("기본 정보 전송 : ", data);
						callApi("PUT", "/api/user/" + userId+"/basicInfo/", JSON.stringify(data),
                            function(resData) {
                                console.log(resData);
                                // dModal.confirm("기본 정보가 등록되었습니다. \n 이제 이력서를 등록할 수 있습니다. \n 등록하시겠습니까?");
                                dModal.alert("기본 정보를 등록했습니다.", function () {
                                    // 등록 완료 후 이동.
                                    if ( SPECIFIC_TAB_MODE ) {
                                        window.history.back();
                                    } else {
                                        document.getElementById("tabFinal").checked = true;
                                        document.getElementById("tabFinal").dispatchEvent(new CustomEvent("change"));
                                    }
                                });
                            },
                            function(errorCode, errorMsg) {
                                alert("에러 [" + errorCode + "] ==> [" + errorMsg + "]");
                            },
                            'application/json'
                        );

                        selectedJuso = null;
                    }
                    basicInfoForm.addEventListener("submit", registerMyInfo);


                    // 주소 모달 바인딩
                    // var jusoModal = new JusoModal(function(newSelectedJuso) {                        
                    //     selectedJuso = newSelectedJuso;
                    //     console.log(selectedJuso);
                                                
                    //     document.getElementById("myInfoAddrMain").value = newSelectedJuso.roadAddrPart1;          // 주소 앞 부분 설정
                    //     console.log("주소 앞부분 [" + document.getElementById("addrMain").value + "]");
                        
                    //     document.getElementById("myInfoAddrDetail").value = "";
                    //     document.getElementById("myInfoAddrDetail").readOnly = false;
                    //     document.getElementById("myInfoAddrDetail").focus();                                         // 포커스 이동
					// });
					
					

                    // 주소 모달 띄우기
                    // document.getElementById("myInfoAddrMain").addEventListener("click", function(event) {
					// 	// this.disabled = true;
					// 	event.preventDefault();
					// 	JUSO_MODAL.setFuncAfterSelecting(function(newSelectedJuso) {                        
					// 		selectedJuso = newSelectedJuso;
					// 		console.log("기본정보 - 콜백으로 받은 주소 객체 : ", selectedJuso);
													
					// 		document.getElementById("myInfoAddrMain").value = newSelectedJuso.roadAddrPart1;          // 주소 앞 부분 설정
					// 		console.log("기본정보 - 주소 앞부분 [" + document.getElementById("addrMain").value + "]");
							
					// 		document.getElementById("myInfoAddrDetail").value = "";
					// 		document.getElementById("myInfoAddrDetail").readOnly = false;
					// 		document.getElementById("myInfoAddrDetail").focus();                                         // 포커스 이동
					// 	});
						
                    //     JUSO_MODAL.openJusoModal(event);
                    // });

                    return {
                        init: function() {
                            loadMyInfo();
                        }
                    }

                })();
            </script>
                


            
            <!--================================================================================================-->
            <!--                                                                                                -->
            <!--                                             완료                                               -->
            <!--                                                                                                -->
            <!--================================================================================================-->
            <div class="step-content" hidden>
                <button class="btn btn-primary" type="action" onclick="location.href = 'liveboard.html'">완료</button> // 임시로 조치
            </div>
        </div>
    </section>
<script src="js/dental_ui.js"></script>
<script src="js/lib/address.js"></script>
<script>
    $(".call-juso-search").on("click", function callJusoSearch(e) {

        var juso = new JusoSearch(".juso-search-wrapper", e.target);
        juso.reset();
        juso.open();
        this.blur();
    });
</script>
</body>

</html>


