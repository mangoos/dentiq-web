<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="robots" content="index, follow">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="author" content="https://github.com/aaa/">
    <title>덴탈플러스</title>
    <link href="css/fontawesome/css/fontawesome-all.css" rel="stylesheet"> <!-- font awesome 5.* pro -->
    <link rel="stylesheet" href="css/dentalBasic.css">

    <script src="js/jquery-1.12.4.min.js"></script>
    <script src="js/handlebars.min.js"></script>
    <script src="js/common.js"></script>
    <script src="js/dental_ui.js"></script>
    <style>
        .local-item { position: relative; display: block; }
        .local-item-name { display: inline-block; transform: translateY(-0.2rem); }
        .local-item-cnt { position: absolute; bottom: -0.5rem ; left: 50%; transform: translateX(-50%); font-size: 0.5rem; color: #0083cb; }
        .local-item-cnt:before { content: "("; display: inline-block; margin-right: 0.1rem; }
        .local-item-cnt:after { content: ")"; display: inline-block; margin-left: 0.1rem; }

        .my-local-item { position: relative; display: block; height: 2.3rem; line-height: 2.3rem; padding-left: 0.15rem; padding-top: 0.3rem; }
        .my-local-item-sido { position: absolute; color: #777; top: -0.6rem; left: 0.2rem; font-size: 0.5rem; font-weight: bold; }
        .my-local-item-cnt { color: red; font-size: 0.5rem; margin-left: 0.2rem; }
        .my-local-item-cnt:before { content: "("; display: inline-block; margin-right: 0.1rem; }
        .my-local-item-cnt:after { content: ")"; display: inline-block; margin-left: 0.1rem; }
    </style>
</head>

<body>
    <input id="sidebar" type="checkbox" name="sidebar" hidden>
    <header>
        <div class="main-header navbar">
            <section class="navbar-section">
                <!-- 사이드바 버튼 -->
                <label for="sidebar" class="main-header-icon"><i class="fal fa-bars"></i></label>
            </section>
            <input class="search-checkbox" type="checkbox" id="main-search-checkbox" hidden>
            <section class="navbar-center">
                <!-- 브랜드 로고 -->
                <a class="navbar-brand main-header-brand" href="start.html">Dental+</a>
                <div class="main-search">
                    <input class="main-search-input" type="search" name="main-search" placeholder="키워드 입력">
                    <label class="main-search-submit"><input type=submit hidden><i class="far fa-search"></i></label> <!-- 버튼 방식으로 변경 해야하남? -->
                </div>
                <script>
                    var searchWindow = document.querySelector(".main-search-input");
                    var checkboxForSearch = document.querySelector(".search-checkbox");
                    // 선정우 - 검색창에서 포커스 아웃할 때, 값 없으면 검색창 안보이게 처리, 체크박스로 on/off 하고 있음
                    searchWindow.addEventListener("focusout", function(e) {
                        if (!searchWindow.value) { checkboxForSearch.checked = false; }
                        else { console.log("search keyword: ", searchWindow.value); }
                    });
                </script>
            </section>
            <section class="navbar-section">
                <!-- 사이드바 버튼 -->
                <label for="main-search-checkbox"><span class="main-header-icon"><i class="far fa-search"></i></span></label>
                <a href="user_panel.html" class="main-header-icon"><i class="fal fa-user-alt"></i></a>
                <script>
                    var labelForSearch = document.querySelector(".search-checkbox");
                    labelForSearch.addEventListener("change", function(e) {
                        console.log(searchWindow, this);
                        searchWindow.focus();
                    });
                </script>
            </section>
        </div>
        <div class="header-nav">
            <ul class="header-nav-list" id="header-nav-list"></ul>
            <script>
                var headerNavListHtml = "";
                if ( LOGIN_INFO.isLoggedIn() && LOGIN_INFO.isHospitalMember() ) {           // 로그인 && 병원회원
                    headerNavListHtml =
                        '<li class="header-nav-item"><a href="liveboard.html?LIVEBOARD">라이브보드</a></li>';
                } else if ( LOGIN_INFO.isLoggedIn() && LOGIN_INFO.isPersonalMember() ) {    // 로그인 && 개인회원
                    headerNavListHtml = 
                        '<li class="header-nav-item"><a href="liveboard.html?LIVEBOARD">라이브보드</a></li>' +
                        '<li class="header-nav-item"><a href="liveboard.html?LOCAL">관심 지역</a></li>' +
                        '<li class="header-nav-item"><a href="liveboard.html?HOME">우리 동네</a></li>' +
                        '<li class="header-nav-item"><a href="register_resume.html">내 이력서</a></li>';
                } else {                                                                    // 로그인 안함
                    headerNavListHtml = 
                        '<li class="header-nav-item"><a href="liveboard.html?LIVEBOARD">라이브보드</a></li>'
                        '<li class="header-nav-item"><a href="liveboard.html?LOCAL">관심 지역</a></li>'
                        '<li class="header-nav-item"><a href="liveboard.html?HOME">우리 동네</a></li>'
                        '<li class="header-nav-item"><a href="register_resume.html">내 이력서</a></li>';
                }
                document.getElementById("header-nav-list").innerHTML = headerNavListHtml;
            </script>
        </div>
    </header>

    <div class="off-canvas">
        <div id="sidebar1" class="off-canvas-sidebar">  <!-- 사이드바 -->
            <ul class="menu" id="sidebarMenu">

            </ul>
        </div>
        <label for="sidebar"><div class="off-canvas-overlay"></div></label>   <!-- 메뉴 close -->
    </div>
    <script>
        function onChangeSidebar(event) {
            event.preventDefault();
            console.log("사이드바 !!!!");

            var sidebarMenuHtml = "";

            var currentHref = location.href;
            if ( LOGIN_INFO.isLoggedIn() ) {
                sidebarMenuHtml = `
                    <!-- 이메일 및 사진 -->
                    <li class="menu-item">
                        <div class="tile tile-centered" id="sidebar-email">
                            <div class="tile-icon"><img src="img/avatar-4.png" class="avatar" alt="Avatar"></div>
                            <div class="tile-content">` + LOGIN_INFO.getEmail() + `</div>
                        </div>
                    </li>

                    <!-- 개인회원 -->
                    <li class="divider" data-content="개인회원"></li>
                    <li class="menu-item">
                        <a href="liveboard.html">라이브보드</a>
                    </li>
                    <li class="menu-item">
                        <div class="menu-badge"><a href="register_user.html?LOCAL"<label class="label label-primary">설정하러가기</label></a></div>
                        <a href="liveboard.html?LOCAL">관심 지역</a>
                    </li>
                    <li class="menu-item">
                        <div class="menu-badge"><a href="register_user.html?HOME"><label class="label label-primary">설정하러가기</label></a></div>
                        <a href="liveboard.html?HOME">우리 동네</a>
                    </li>
                    <li class="menu-item">
                        <a href="user_interaction.html">관심 병원</a>
                    </li>
                    <li class="menu-item">
                        <a href="user_interaction.html?SCARP">내 스크랩</a>
                    </li>
                    <li class="menu-item"><a href="register_resume.html">이력서 관리</a></li>

                    <!-- 병원회원 -->
                    <li class="divider" data-content="병원회원"></li>
                    <li class="menu-item"><a href="liveboard.html">라이브보드</a></li>
                    <li class="menu-item"><a href="register_dentist.html">우리병원 기본 정보</a></li>
                    <li class="menu-item"><a href="register_jobad.html">채용공고 등록</a></li>
                    <li class="menu-item"><a href="jobAd_interaction.html">채용공고 관리</a></li>
                    <li class="menu-item"><a href="dentist_panel.html">면접 제안</a></li>
                    <li class="menu-item"><a href="dentist_panel.html">지원자 관리</a></li>

                    <!-- 로그인 회원가입 로그아웃 -->
                    <li class="divider"></li>
                    <div id="sidebar-login-logout">
                        <li class="menu-item" id="sidebar-logout"><a href="liveboard.html" onClick="javascript:LOGIN_INFO.logout()">로그아웃</a></li>
                        <li class="menu-item"><a href="#menus">설정</a></li>
                    </div>
                `;
            } else {
                sidebarMenuHtml = `
                    <!-- 이메일 및 사진 -->
                    <li class="menu-item">
                        <div class="tile tile-centered" id="sidebar-email">
                            <div class="tile-icon"></div>
                            <div class="tile-content"></div>
                        </div>
                    </li>

                    <!-- 개인회원 -->
                    <li class="divider" data-content="개인회원"></li>
                    <li class="menu-item">
                        <a href="liveboard.html">라이브보드</a>
                    </li>
                    <li class="menu-item">
                        <div class="menu-badge"><a href="register_user.html?LOCAL"<label class="label label-primary">설정하러가기</label></a></div>
                        <a href="liveboard.html?LOCAL">관심 지역</a>
                    </li>
                    <li class="menu-item">
                        <div class="menu-badge"><a href="register_user.html?HOME"><label class="label label-primary">설정하러가기</label></a></div>
                        <a href="liveboard.html?HOME">우리 동네</a>
                    </li>
                    <li class="menu-item">
                        <a href="user_interaction.html">관심 병원</a>
                    </li>
                    <li class="menu-item">
                        <a href="user_interaction.html?SCARP">내 스크랩</a>
                    </li>
                    <li class="menu-item"><a href="register_resume.html">이력서 관리</a></li>

                    <!-- 병원회원 -->
                    <li class="divider" data-content="병원회원"></li>
                    <li class="menu-item"><a href="liveboard.html">라이브보드</a></li>
                    <li class="menu-item"><a href="register_dentist.html">우리병원 기본 정보</a></li>
                    <li class="menu-item"><a href="register_jobad.html">채용공고 등록</a></li>
                    <li class="menu-item"><a href="jobAd_interaction.html">채용공고 관리</a></li>
                    <li class="menu-item"><a href="dentist_panel.html">면접 제안</a></li>
                    <li class="menu-item"><a href="dentist_panel.html">지원자 관리</a></li>

                    <!-- 로그인 회원가입 로그아웃 -->
                    <li class="divider"></li>
                    <div id="sidebar-login-logout">
                        <li class="menu-item" id="sidebar-login"><a href="login.html?returnUrl=` + currentHref + `">로그인</a></li>
                        <li class="menu-item" id="sidebar-signup"><a href="signup.html?returnUrl=` + currentHref + `"">회원가입</a></li>
                    </div>
                `;
            }
            document.getElementById("sidebarMenu").innerHTML = sidebarMenuHtml;
            
        }
        document.getElementById("sidebar").addEventListener("change", onChangeSidebar);
        document.getElementById("sidebar").dispatchEvent(new Event("change"));
    </script>

    




    <!-- ======================== 공고 속성 선택 BOX ======================== -->
    <!-- 공고 속성 선택 BOX는 다른 것으로 변경될 수 있음 -->
    <section class="liveplus container">
        <input class="local-box-check" type="checkbox" id="liveplus-local-box-check" hidden>
        <div class="liveplus-bar navbar">

			<!-- 전국/특정시도 선택 영역 -->
            <div class="navbar-section" id="divLiveBoardSidoLabel">
                <label class="liveplus-bar-icon"><i class="fas fa-map-marker-alt"></i></label>
                <ul class="liveplus-breadcrumb">
					<li class="liveplus-breadcrumb-item" id="locationReset">전국</li>			<!-- 여기는 클릭하면, CURRENT_SIDO_CODE가 null로 설정 -->
					<li class="liveplus-breadcrumb-item" id="currentLocationSidoLabel"></li>    <!-- :empty 사용, 여기는 클릭하면, 선택된 시도 표시 -->
					<li class="liveplus-breadcrumb-item" id="countOfTotalAds"></li>
                </ul>
                <div class="liveplus-bar-rbox"><label class="liveplus-bar-icon" for="liveplus-local-box-check"><i class="fas fa-chevron-up"></i></label></div>
            </div>

			<!-- LIVE FILTER 선택 영역-->
            <div class="navbar-section">
                <label class="liveplus-bar-icon" for="livefilter-modal">
                    <i class="fas fa-filter"></i>
                    <span>LIVE FILTER <span id="filterChipLength" style="color: #0083cb; font-size: 0.5rem;" data-chip-length="( 전체" > 선택 )</span></span>
                </label>
                <div class="liveplus-bar-rbox">
                    <label class="liveplus-bar-icon" for="livefilter-modal"><i class="fas fa-cog"></i></label>
                </div>
            </div>
        </div>


        <form id="searchForm">
            <div class="dental-modal liveplus-modal" id="jobAdAttrSelector">
                <input type="checkbox" id="livefilter-modal" name="modal-toggle" hidden> <!-- 모달 체크박스, 위치 이동하면 안됨 -->
                <input id="livefilter-reset" type="checkbox" hidden>
                <label for="livefilter-modal"><div class="dental-modal-overlay"></div></label> <!-- 배경, 체크박스로 하면 배경을 레이블로 해서 모달 죽일 수 있음-->
                <div class="dental-modal-container columns">
                    <div class="modal-container-header">
                        <div class="modal-container-header-title">LIVE Filter</div>
                        <label class="modal-close-label" for="livefilter-modal" rel="dental-modal" title="닫기"><i class="fas fa-window-close"></i></label>
                    </div>
                    <div class="modal-container-body">
                        
                        <div id="divJobAdAttrSelector"></div>   <!-- 라이브필터(공고 속성) -->
                        
                        <script id="jobAdAttrSelectorTemplate" type="text/x-handlebars-template">
                            {{#each .}}
                                <fieldset class="livefilter">
                                    <div class="filter-title"><i class="fas fa-hospital"style="margin-right: 10px;"></i>{{text}}</div>
                                        <label class="filter-{{group}}"><input id="attr-{{group}}" type="checkbox" name="attr" value="" data-checkbox-group="{{group}}"  hidden><span class="chip">전체</span></label>
                                        {{#each element}}
                                            <label class="filter-{{group}}"><input id="attr-{{value}}" type="checkbox" name="attr" value="{{value}}"  data-checkbox-group="{{group}}"  hidden><span class="chip">{{text}}</span></label>
                                        {{/each}}
                                </fieldset>
                            {{/each}}
                        </script>

                        <script>
                            document.getElementById("divJobAdAttrSelector").innerHTML = 
                                Handlebars.compile(document.getElementById("jobAdAttrSelectorTemplate").innerHTML)(CODE_CONTAINER.getAttrs());
                        </script>

                    </div>
                    <div class="modal-container-footer"></div>
                </div>
            </div>
            <script>

                function renderAttrChips() {
                    var allAttrs = document.querySelectorAll("input[type=checkbox][name='attr']:not([value=''])"); // parent 를 캐쉬해놓고 하면 더 나을 듯
                    var allAttrsChecked = document.querySelectorAll("input[type=checkbox][name='attr']:checked:not([value=''])"); // 선정우,
                    var livepusFooter = document.getElementById("liveplusFooter"); // 선정우, 할 필요 없지만 안해놓으면 아래 헷갈릴까봐 변수 선언.
                    var filterChipLengthElm = document.getElementById("filterChipLength"); // 선정우
                    //allAttrs.forEach(showAttrChip(element, index));
                    allAttrs.forEach(function(element) {
                        if ( element.checked ) {
                            $(".livefilter-chip .chip[for='" + element.id + "']").show(); 
                            liveplusFooter.style.display = "block"; // 선정우 한땀 땄음
                        } else {
                            $(".livefilter-chip .chip[for='" + element.id + "']").hide();
                            if ( !allAttrsChecked.length ) { 
                                livepusFooter.removeAttribute("style"); // 선정우, 체크된 개별-전체 제외-칩이 0이면 푸터 박스 안보이게 합니다.
                                filterChipLengthElm.dataset.chipLength = "( 전체"; // 선정우가 한땀 땄음
                            } else {
                                filterChipLengthElm.dataset.chipLength = "( " + allAttrsChecked.length + " 개"; // 선정우 한땀 땄음
                            }
                        }
                    });
                }
                
                // 공고 속성 변경시, 칩을 표시하고, submit
                function afterChangedAttrCheckboxes() {
                    renderAttrChips();
                    $("#searchForm").submit();
                }
                // 공고 속성들을 그룹별로 '전체'와 묶어 준다.
                var checkboxGroup = new DynamicCheckboxGroup(document.getElementById("searchForm"), "attr", afterChangedAttrCheckboxes);
                checkboxGroup.check();  // 초기값 세팅 (지금은 모두 '전체'로)
			
				
				// 지역 변경 시 SUBMIT
				$(".liveplus").on("click", "input[name=sidoCode]", function(e) {
					$("#searchForm").submit();
				});
				// 지역 변경 시 SUBMIT
				$(".liveplus").on("click", "input[name=siguCode]", function(e) {
					CHANGED_BY_SIGU = true;
					$("#searchForm").submit();
				});
				

                // 리프레쉬 아이콘 클릭했을 때, 회전 효과 및 칩 숨기기(초기화), submit
                // 임시 핸들러 임, 초기화 제대로 안되고 있음
                $(".liveplus").on("click", ".fa-refresh", function(e) {
                    var livepusFooter = document.getElementById("liveplusFooter"); 
                    // A. 아이콘 회전
                    $(this).css({
                        "transform": "rotate(360deg)",
                        "transition": "all 0.5s ease"
                    });
                    console.log("리프레쉬 아이콘 클릭 fa-refresh :   .liveplus --> click --> .fa-refresh ", this);

                    // B. 칩 전체 숨기기 (초기화)
                    $(".livefilter-chip .chip").hide();
                    
                    checkboxGroup.check();  // 초기값 세팅 (지금은 모두 '전체'로)
                    
                    // C. submit 처리
                    $("#searchForm").submit();

                    // 선정우, Footer 필터 칩 박스 숨기기
                    livepusFooter.removeAttribute("style");
                    filterChipLength.dataset.chipLength = "( 전체"; // 선정우가 한땀 땄음, 위에 renderAttr~~ 함수랑 통합해야할 듯 ㅠ
                });
            </script>

            <!-- ======================== 지역 선택 BOX ======================== -->
            <div class="local-box columns" id="locationSelector"></div>
		</form>
		

        <!-- 체크박스로 푸터 박스 on/off 할 수 있음, 지금은 그냥 스크립트로 되어 있음 -->
        <input class="liveplus-footer-check" type="checkbox" id="" hidden>
        <div class="liveplus-footer" id="liveplusFooter" hidden>
            <div class="livefilter-chip" id="divJobAdAttrChip"></div>   <!-- 라이브필터(공고 속성) 칩 -->
            <script id="jobAdAttrChipTemplate" type="text/x-handlebars-template">
                {{#each .}}
                    {{#each element}}
                        <label class="filter-EMP chip" for="attr-{{value}}" style="display: none;">{{text}}<span class="btn btn-clear"></span></label>
                    {{/each}}
                {{/each}}
            </script>

            <script>
                document.getElementById("divJobAdAttrChip").innerHTML = 
                    Handlebars.compile(document.getElementById("jobAdAttrChipTemplate").innerHTML)(CODE_CONTAINER.getAttrs());
            </script>

            <div class="livefilter-box"><label for="livefilter-reset" title="라이브필터 초기화"><i class="fal fa-sync-alt fa-refresh"></i></label></div>
        </div>

    </section>

    <!-- ======================== 프리미어 공고 ======================== -->
    <section id="section-premiereAds" class="premiere-ad">
        <div class="jobpost-list-bar">
                <span class="typo-title2">프리미어 채용정보</span>
                <span class="jobpost-list-bar-counter" id="countOfPremierAds">0</span>
        </div>
        <div class="premiere-ad-box columns" id="premierJobAdsList"></div>
        <script id="premierJobAdsTemplate" type="text/x-handlebars-template">
            {{#each .}}
            <a href="jobad.html?jobAdId={{id}}" class="column col-6 card">
                <div class="hospital-log-box"><div class="logo-frame-hospital"><img src="{{fullLogoUrl}}"></div></div>
                <!-- <div class="card-image"><img src="{{fullLogoUrl}}" class="img-responsive"></div> -->
                <div class="card-header">
                    <div class="card-title">{{hospital.hospitalName}}</div>
                    <div class="card-subtitle">{{title}}</div>
                </div>
                <div class="card-body">
                    <div class="dental-info">
                        <span class="info-detail">{{renderLocationOfJobAdCard hospital.location.locationCode}}</span> <!-- 시도, 시구군 정보 -->
                        <span class="info-detail">{{hiringEndDate}} ({{hiringEndDateDay}})</span> <!-- 마감날짜 -->
                    </div>
                    <div class="dental-info">{{{renderAttrOnCard attr}}}</div>
                </div>
                <label><input type="checkbox" name="scrap" value="{{id}}" hidden><i class="fas fa-star" title="관심 공고를 스크랩하세요!"></i></label>
            </a>
            {{/each}}
        </script>
    </section>

    <!-- ======================== 일반 공고 ======================== -->
    <section id="section-generalAds" class="jobpost-list">
        <div class="jobpost-list-bar">
            <span class="typo-title2">라이브 채용정보</span>
            <span class="jobpost-list-bar-counter" id="countOfGeneralAds">0</span>
        </div>
        <div class="jobpost-list-body" id="generalJobAdsList"></div>
        <script id="generalJobAdsTemplate" type="text/x-handlebars-template">
            {{#each .}}
            <div class="jobpost-list-card">
                <a href="jobad.html?jobAdId={{id}}">
                    <div class="jobpost-list-card-header">
                        <div class="jobpost-list-card-title">{{hospital.hospitalName}}</div>
                        <div class="jobpost-list-card-subtitle">{{title}}</div>
                    </div>
                    <div class="jobpost-list-card-body">
                        <div class="dental-info">
                            <span class="info-detail hospital-region">{{renderLocationOfJobAdCard  hospital.location.locationCode}}</span>
                            <span class="info-detail subway-line">
                                <span class="subway102"><i></i></span> <!-- 지하철 작업하면서 클래스 대신 data-tag 로 변경 필요, 검토해주세욧 -->
                                <span class="subway117"><i></i></span> <!-- 'span.info-detail' 하위에 span 이 3개 이상이면 i 태그에 "외" 삽입됨 -->
                                <span>서울 3호선<i></i></span> <!-- 3개부터는 안보임, css 로 display:none 처리 -->
                                <span class="subway120"><i></i></span> <!-- 텍스트가 들어오면 그냥 텍스트로 노출됨, 노출되는 개수 등 그 외 로직은 그대로 적용-->
                            </span>
                            <!-- 시도, 시구군 정보, 교통정보 -->
                            <span class="info-detail">
                                {{#each hashTag}}
                                    <span>#{{.}}<i></i></span>
                                {{/each}}
                            </span>
                            <!-- 주변 핫플레이스 -->
                        </div>
                        <div class="dental-info">
                            {{{renderAttrOnCard attr}}}
                            <!-- <span class="info-detail">12 / 26 (화)</span> -->
                            <!-- 마감날짜 -->
                        </div>
                    </div>
                </a>
                <div class="jobpost-list-card-footer">
                    <!-- a 태그 추가하고 클래스 단순하게 정리 해야함 -->
                    <span class="footer-item">{{hiringEndDate}} ({{hiringEndDateDay}})</span>
                    <span class="footer-item"><label><input type="checkbox" name="scrap" value="{{id}}" hidden><i class="fas fa-star"></i>스크랩</label></span>
                    <span class="footer-item" data-action="apply" data-action-value="{{id}}"><i class="far fa-hand-point-up"></i>원클릭지원</span>
                    <span class="footer-item" data-action="call"  data-action-value="{{id}}"><i class="fas fa-phone"></i>전화문의</span>
                </div>
            </div>
            {{/each}}
        </script>
    </section>
    <!-- loading spinner, 'active' 클래스로 활성화 -->
    <div class="dental-loading" id="loadingModal" hidden>
        <div class="fa-icon"><i class="fa fa-spinner fa-pulse fa-2x fa-fw"></i></div>
        <div class="loading-overlay" hidden></div>
    </div>
</body>
</html>

<script>
var dModal = dentalModal();

// 속도가 빠름. 그러나 ordering 안 됨 ==> 입력할 때의 ordering을 의지한다 ㅠㅠ
function renderAttrOnCard2(attrList) {
    if ( attrList==null || attrList.length==0 ) return "";

    var defAttrMap = CODE_CONTAINER.getAttrMap();

    var target = {};

    attrList.forEach(function(attr) {
        var attrGroupName = attr.split(".")[0];
        if ( defAttrMap[attrGroupName] && defAttrMap[attrGroupName].element[attr] ) {
            // 
            if ( !target[attrGroupName] ) {
                target[attrGroupName] = {};
                target[attrGroupName].order = defAttrMap[attrGroupName].order;
                target[attrGroupName].element = {};
            }
            target[attrGroupName].element[attr] = defAttrMap[attrGroupName].element[attr];
        }
    });

    

    return target;

}

// 속도 느림. 그러나 ordering 됨
function renderAttrOnCard(attrList) {
    if ( attrList==null || attrList.length==0 ) return "";

    var html = "";

    var defAttrGroupList = CODE_CONTAINER.getAttrs();
    defAttrGroupList.forEach(function(defAttrGroup) {
        html += '<span class="info-detail">';
        defAttrGroup.element.forEach(function(defAttr) {
            var defAttrValue = defAttr.value;

            attrList.forEach(function(attr) {
                if ( defAttrValue == attr ) {
                    html += "<span>" + defAttr.text + "<i></i></span>";
                }
            });
        });
        html += '</span>';
    });

    return html;
}




var CHANGED_BY_SIGU = false;

var LiveBoardApp = (function() {

	var CURRENT_SIDO_CODE = null;				// 현재 선택된 시도 코드
	

    // 스크랩된 공고에 별표시
    function renderScrap() {
        // 전체를 unchecked로 변경
        document.querySelectorAll("input[type=checkbox][name='scrap']").forEach(function(element) {
            element.checked = false;
        });

        // 스크랩된 것만 checked로 변경
        var scrappedJobAdIds = LOGIN_INFO.getScrappedJobAdIds();
        if ( scrappedJobAdIds ) {
            scrappedJobAdIds.forEach(function(jobAdId) {
                //console.log("스크랩 대상 : ", jobAdId);
                document.querySelectorAll("input[type=checkbox][name='scrap'][value='" + jobAdId + "']").forEach(function(element) {
                    //console.log("스크랩 대상 : ", jobAdId, " ==> TRUE");
                    element.checked = true;
                });
            });
        }
    }

    function onClickForCardAction(event) {
        var target = event.target;

        if ( (target.type && target.type=='checkbox' && target.name=='scrap') || (target.dataset && target.dataset.action && target.dataset.actionValue) ) {
            if (!LOGIN_INFO.isLoggedIn()) {
                event.preventDefault();
                alert("로그인이 필요합니다.");
                location.href = "login.html?returnUrl=liveboard.html";
                return;
            }

            if ( !LOGIN_INFO.isPersonalMember() ) {
                event.preventDefault();
                alert("개인회원만 이용 가능합니다.");
                return;
            }
        }


        // 스크랩 처리
        // input[type=checkbox][name=scrap]
        if ( target.type && target.type=='checkbox' && target.name=='scrap' ) {
            console.log("스크랩 잡았음 : ", target, " ==> ", target.checked);
            event.preventDefault(); // 여기서 막아야지 checkbox가 checked되는 것을 방지할 수 있음
         
            console.log("일반 공고 스크랩 ", target.value , "  ==> ", target.checked);
            if ( target.checked ) {
                LOGIN_INFO.addScrappedJobAdId(target.value, renderScrap);       // 완료되고 난 후에는 checkbox의 checked 상태를 변경해야 함
            } else {
                LOGIN_INFO.removeScrappedJobAdId(target.value, renderScrap);    // 완료되고 난 후에는 checkbox의 checked 상태를 변경해야 함
            }
            
            return;
        }
        

        // 바로지원, 전화문의
        if ( target.dataset && target.dataset.action && target.dataset.actionValue ) {            
            
            var userId = LOGIN_INFO.getId();
            
            console.log("잡았음 : ", target);
            var action = target.dataset.action;
            var value  = target.dataset.actionValue;

            // ============== 바로 지원 ==============
            if ( action=="apply" ) {
                // 모달로 변경하기
                var goApply = confirm("해당 공고에 바로 지원하시겠습니까?");
                if ( goApply ) {
                    //alert("지원한걸로 칩시다");
                    var applyWay = "applyWay=oneclick";

                    callApi("POST", "/api/user/"+userId+"/appliedJobAdId/"+value+"/", applyWay,
                        function(resData) {
                            console.log(resData);
                            alert("등록되었습니다. ",);
                        },
                        function(errorCode, errorMsg) {
                            console.log("에러 1 [" + errorCode + "] ==> [" + errorMsg + "]");
                            alert("에러 1 [" + errorCode + "] ==> [" + errorMsg + "]");
                        }
                    );

                } else {
                    alert("지원하지 않았습니다");
                }


            // ============== 전화 문의 ==============
            } else if ( action=="call" ) {
                document.location.href='tel:010-7209-3356';
            }

            // ============== 스크랩도 여기로 이동하자  ==============

        }
    }
    document.getElementById("generalJobAdsList").addEventListener("click", onClickForCardAction);



    Handlebars.registerHelper("renderLocationOfJobAdCard", function(code) {
        //console.log("LOCATION_HELPER ", code);
        var location = LOCATION_CODE.getByName(code);
        if ( location ) return location.sidoName + " > " + location.siguName ;
        else return "입력안됨";
    });
    Handlebars.registerHelper("renderAttrOnCard", function(code) {
        //console.log("renderAttrOnCard ", code);
        return renderAttrOnCard(code);
    });




    /******************************************************************************/
    /* <ul class="liveplus-breadcrumb breadcrumb"> 영역 처리
    /*
    /*
	/******************************************************************************/
	
	function resetClickDivLiveBoardSidoLabel() {
		var sidoCodeCheckboxes = document.querySelectorAll("input[type=checkbox][name='sidoCode']:checked");
        sidoCodeCheckboxes.forEach(function(element) {
            element.checked = false;
		});

		var sidoCodeCheckboxes = document.querySelectorAll("input[type=checkbox][name='siguCode']:checked");
        sidoCodeCheckboxes.forEach(function(element) {
            element.checked = false;
		});
	}

    // '전국'를 클릭한 경우에, 지역 선택을 reset한다.
    document.getElementById("locationReset").addEventListener("click", function(event) {
		resetClickDivLiveBoardSidoLabel();

		CURRENT_SIDO_CODE = null;
		$("#searchForm").submit();
    });
    
    // '전국' 다음의 특정 시도를 클릭한 경우, 해당 시도의 대쉬보드 그려준다.
    document.getElementById("currentLocationSidoLabel").addEventListener("click", function(event) {
		//console.log("현재 시도 눌렸음 : ", document.getElementById("currentLocationSidoLabel").innerText);
		
		resetClickDivLiveBoardSidoLabel();
        $("#searchForm").submit();
    });







    var GENERAL_JOB_ADS_PER_PAGE = 10;        // 스크롤 사이즈 (한 페이지에서 보여질 아이템 개수)
    var SCROLL_LOCK = false;                    // 페이지 스크롤 LOCK

	var totalCountOfGeneralJobAds = 0;          // 전체 일반 공고 개수
	var totalCountOfPremierJobAds = 0;			// 프리미어 공고 개수
    var lastPageNo = 1;                         // 최근 조회 페이지
	var lastQueryString;                        // 최종 Query String
	
	



    /******************************************************************************/
    /*  프리미어 공고 로딩 및 출력
    /*  
    /*******************************************************************************/
    var premierJobAdsTemplate = document.getElementById("premierJobAdsTemplate").innerHTML;
    var premierJobAdsTemplateCompiled = Handlebars.compile(premierJobAdsTemplate);

    function listPremierJobAds(_queryParamString) {

        var searchParam = "adType=2&pageSize=5&" + _queryParamString; // 프리미어 광고 유형 추가      // adType=2 프리미어 공고
        console.log("listPremierJobAds : searchParam:", searchParam);
        callApi("GET", "/api/jobAd/", searchParam,
            function(jobAdList) {
                var itemList = premierJobAdsTemplateCompiled(jobAdList);
                $('#premierJobAdsList').html(itemList);
            },
            function(errorCode, errorMsg) {
                console.log("에러 1 [" + errorCode + "] ==> [" + errorMsg + "]");
                alert("에러 1 [" + errorCode + "] ==> [" + errorMsg + "]");
            }
        );
    }



    /******************************************************************************/
    /*  일반 공고 로딩 및 출력
    /*  
    /*******************************************************************************/
    var generalJobAdsTemplate = document.getElementById("generalJobAdsTemplate").innerHTML;
    var generalJobAdsTemplateCompiled = Handlebars.compile(generalJobAdsTemplate);

    function listGeneralJobAds(_pageNo, _queryParamString) {

        if (SCROLL_LOCK) {
            console.log("SCROLL LOCKED - in JS");
            setTimeout(function() {
                SCROLL_LOCK = false;
                console.log("listJobAds:SCROLL_LOCK 풀렸음");
            }, 500);
            return;
        }
        SCROLL_LOCK = true;


        console.log('listGeneralJobAds CALLED. _pageNo:', _pageNo);
        if (_pageNo == null) pageNo = 1;
        else pageNo = _pageNo;

        //var searchParam = searchCondition.toQueryString(pageNo);
        var searchParam = "adType=1&pageNo=" + pageNo + "&" + _queryParamString;    // adType=1 일반 공고
        console.log("searchParam:", searchParam);
        callApi("GET", "/api/jobAd/", searchParam,
            function(jobAdList) {
                lastPageNo = pageNo; // 최근 페이지 번호를 변경한다.

                //console.log(generalJobAdsTemplate);
                var itemList = generalJobAdsTemplateCompiled(jobAdList);

                if (pageNo != null && pageNo > 1) $('#generalJobAdsList').append(itemList);
                else $('#generalJobAdsList').html(itemList);

                // 스크랩된 공고에 별표시
                renderScrap();

                SCROLL_LOCK = false;
            },
            function(errorCode, errorMsg) {
                console.log("에러 1 [" + errorCode + "] ==> [" + errorMsg + "]");
                alert("에러 1 [" + errorCode + "] ==> [" + errorMsg + "]");
                SCROLL_LOCK = false;
            }
        );

    }
    /******************************************************************************/
    /*  스크롤했을 때, 일반 공고에 대한 append 처리
    /*  
    /*******************************************************************************/
    $(window).scroll(function() {
        if (totalCountOfGeneralJobAds == 0) return;

        var maxPageNo = totalCountOfGeneralJobAds / GENERAL_JOB_ADS_PER_PAGE + 1; // 한 페이지에 10개의 목록 지정 (개수 조정 시 변경 필요)
        if ((lastPageNo + 1) >= maxPageNo) return;

        if (SCROLL_LOCK) {
            console.log("SCROLL : LOCKED");
            setTimeout(function() {
                SCROLL_LOCK = false;
                console.log("SCROLL_LOCK 풀렸음");
            }, 500);
            return;
        }

        if (Math.ceil($(window).scrollTop()) >= ($(document).height() - $(window).height() * 3)) {
            listGeneralJobAds(lastPageNo + 1, lastQueryString);
        }
    });


	var lastSummary = null;

	var lastSummaryCondition = {};

    /******************************************************************************/
    /*  검색 처리
    /*  
    /*******************************************************************************/
    function searchLiveBoard(queryParamString) {
		

		document.getElementById("divLiveBoardSidoLabel").style.display="";

		console.log("검색 : ", queryParamString);
		lastQueryString = queryParamString;
		
		

		var paramMap = parseParamString(queryParamString);
		console.log("==================  ", paramMap);
		

		if ( CHANGED_BY_SIGU ) {
			console.log("시구선택 모드 *******************************");

			var generalAdCnt = 0;
			var premierAdCnt = 0;
			

			lastSummary.locationList.forEach(function(locationItem) {
				if ( containsIn(locationItem.siguCode, paramMap.siguCode) ) {
					console.log("--------  locationItem : " + locationItem.siguCode + "   ==> " + locationItem.cntByJobAdType["1"] + "  " + locationItem.cntByJobAdType["2"]);

					if ( locationItem.cntByJobAdType["1"] ) generalAdCnt += locationItem.cntByJobAdType["1"];
					if ( locationItem.cntByJobAdType["2"] ) premierAdCnt += locationItem.cntByJobAdType["2"];	
				}
			});

			console.log("generalAdCnt : " + generalAdCnt + "    " + "premierAdCnt : " + premierAdCnt);
			
			totalCountOfGeneralJobAds = generalAdCnt;	// 1: 일반 공고
			document.getElementById("countOfGeneralAds").innerText = generalAdCnt;
			totalCountOfPremierJobAds = premierAdCnt;	// 2: 프리미어 공고
			document.getElementById("countOfPremierAds").innerText = premierAdCnt;
			

			function containsIn(str, src) {
				if ( !str || !src) return false;

				if ( Array.isArray(src) ) {
					for ( var i=0; i<src.length; i++ ) {
						if ( str == src[i] ) return true;
					}
					return false;
				} else if ( typeof src === 'string' ) {
					if ( str.trim() == src.trim() ) return true;
					else return false;
				}

				return false;
			}

			// 프리미어 공고 리스트 업데이트
			listPremierJobAds(queryParamString);
			// 공고 리스트 업데이트
			listGeneralJobAds(1, queryParamString);

			CHANGED_BY_SIGU = false;
			return;

		}

		console.log("+++++++++++++++++++++++++++++++++++++ CURRENT_SIDO_CODE : ", CURRENT_SIDO_CODE);
		
		var queryParamStringForSummary = queryParamString;
		if ( CURRENT_SIDO_CODE ) {
			queryParamStringForSummary = "sidoCode="+CURRENT_SIDO_CODE+"&" + queryParamString;
		} 
        callApi("GET", "/api/jobAd/summary/", queryParamStringForSummary,
            function(resData) {

				var htmlStr = "";
				var requestedChecker = "";
                resData.locationList.forEach(function(item) {

					if ( item.requested ) requestedChecker = " checked ";
					else requestedChecker = " ";

					if ( item.locationType=='1' ) {			// 전체(대한민국 시도들)인 경우
						htmlStr += `<label class="local-label col-3"><input type="checkbox" name="sidoCode" value="${item.sidoCode}" hidden ${requestedChecker} ><div class='local-item'><span class='local-item-name'>${item.sidoName}</span><span class='local-item-cnt'>${item.cnt}</span></div></label>`;
                    					
					} else if ( item.locationType=='2' ) {	// 특정 시도를 선택해서, 해당 시도의 시구들인 경우
						htmlStr += `<label class="local-label col-3"><input type="checkbox" name="siguCode" value="${item.siguCode}" hidden ${requestedChecker} ><div class='local-item'><span class='local-item-name'>${item.siguName}</span><span class='local-item-cnt'>${item.cnt}</span></div></label>`;
						
					}
                });
				document.getElementById("locationSelector").innerHTML = htmlStr;


				if ( resData.condition && resData.condition.sidoCode ) {
					document.getElementById("currentLocationSidoLabel").innerText = LOCATION_CODE.getByName(resData.condition.sidoCode).sidoName;									
					CURRENT_SIDO_CODE = resData.condition.sidoCode;
				} else {
					document.getElementById("currentLocationSidoLabel").innerText = "";
					CURRENT_SIDO_CODE = null;
				}


				if ( resData.adTypeList["1"] ) totalCountOfGeneralJobAds = resData.adTypeList["1"];		// 1: 일반 공고
				else totalCountOfGeneralJobAds = 0;
				document.getElementById("countOfGeneralAds").innerText = totalCountOfGeneralJobAds;

				if ( resData.adTypeList["2"] ) totalCountOfPremierJobAds = resData.adTypeList["2"];		// 2: 프리미어 공고
				else totalCountOfPremierJobAds = 0;
				document.getElementById("countOfPremierAds").innerText = totalCountOfPremierJobAds;

				if ( resData.totalCnt )
					document.getElementById("countOfTotalAds").innerText = resData.totalCnt;
				
				lastSummary = resData;
				
            },
            function(errorCode, errorMsg) {
                alert("에러 [" + errorCode + "] ==> [" + errorMsg + "]");
            }
        );

        // 프리미어 공고 리스트 업데이트
        listPremierJobAds(queryParamString);
        // 공고 리스트 업데이트
        listGeneralJobAds(1, queryParamString);
    }

	

    
    // /*******************************************************************************/
    // /*  검색 조건 변경 시의 이벤트 처리
    // /*******************************************************************************/

    // // form이 변경되었을 때, 이에 대한 이벤트 처리
    // // reset인 경우에는 change 이벤트가 적용되지 않아서(확인 필요), reset에 대한 별도 핸들러가 필요한 것으로 판단됨
    // $("#searchCondition").on("change", "form", function(e) {
    //     console.log("searchCondition에 change event 발생");
    //     //console.log("change 이벤트 ==> ", $(this).serialize() );
    //     processSubmit(this);
    // });


    /******************************************************************************/
    /*  submit에 대한 후킹 처리
    /*  서버사이드 제너레이션인 경우에는 이 이벤트 핸들러 주석 처리
    /*******************************************************************************/
    $("#searchForm").submit(function(e) {
        e.preventDefault();
        //console.log("후킹 : ", this);
        processSubmit(this);
    });

    
    /*******************************************************************************/
    /*  submit을 ajax처리로 변환 및 history 관리
    /*******************************************************************************/
    function processSubmit(form) {

		console.log("SUBMIT");

        var action = form.action; // FORM의 action
        var paramString = $(form).serialize(); // FORM의 Query Parameters
               
        console.log("submit 대체 ", action, " params=", paramString);

        searchLiveBoard(paramString);

        // paramString이 기존과 동일한 값이 아니라면, history 처리한다.
    }


	searchLiveBoard();


})();

</script>