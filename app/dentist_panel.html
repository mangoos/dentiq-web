<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="robots" content="index, follow">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="author" content="https://github.com/aaa/">
    <title>덴탈플러스</title>
    <link href="css/fontawesome/css/fontawesome-all.css" rel="stylesheet"> <!-- font awesome 5.* pro -->
	<link rel="stylesheet" href="css/dentalBasic.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.3.5/cropper.css">
	
	<script src="js/jquery-1.12.4.min.js"></script>
	<script src="js/common.js"></script>
	<script src="js/dental_ui.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.3.5/cropper.js"></script>
</head>
<body>
    <header class="register-header navbar">
        <section class="navbar-section">
            <span onclick="if(history.length>2){ history.back(); } else { location.href='liveboard.html'; }">
                <i class="fal fa-arrow-square-left"></i>
                이전페이지
            </span>
        </section>
        <section class="navbar-section">
            <a href="liveboard.html"><i class="fal fa-home"></i></a>
            <a href="dentist_panel.html"><i class="fal fa-user-alt"></i></a>
        </section>
    </header>
    <section class="dentist-panel-section dental-panel">
		<div class="dental-panel-header">
			<div class="user-photo">
				<div class="hospital-log-box">
					<div class="logo-frame-hospital">
						<!-- 이미지 url 입력하면 됨 -->
						<!-- width: 최소 100px 최대 150xp, min-height: 50px, 가운데 정렬임 -->
						<!-- 사이즈 관련 디테일 좀 더 고민해야함 필요 -->
						<img src="" id="hospitalLogo">
						<span class="user-photo-box-icon" id="hospitalLogoArea"><i class="camera-icon"></i></span>
					</div>
				</div>
				<input type="file" id="uploadHospitalLogo" accept="image/*" hidden>
                <script>
                    
                
                </script>
				<div class="user-photo-title" id="userEmail">sjw0927@ gmail.com</div>
				<div class="user-photo-subtitle" id="hospitalName">서울역 앞 치과 병원</div>
			</div>
			<div class="dental-panel-opt"><a href="user_setting.html"><i class="fas fa-cog"></i></a></div>
		</div>
		<div class="panel-nav">
			<nav class="dental-icon-nav">
				<a class="icon-nav-item" href="register_dentist.html">
					<span class="nav-item-icon"><i class="fal fa-hospital"></i></span>
					<span class="nav-item-title">병원정보</span>
				</a>
				<a class="icon-nav-item" href="hospital_interaction.html">
					<span class="nav-item-icon"><i class="fal fa-file-plus"></i></span>
					<span class="nav-item-title">공고등록</span>
				</a>
				<a class="icon-nav-item" href="hospital_interaction.html">
					<span class="nav-item-icon"><i class="fal fa-file-edit"></i></span>
					<span class="nav-item-title">공고수정</span>
				</a>
				<a class="icon-nav-item" href="hospital_interaction.html">
					<span class="nav-item-icon"><i class="fal fa-newspaper"></i></span>
					<span class="nav-item-title">공고알리기</span>
				</a>
				<a class="icon-nav-item" href="hr_management.html">
					<span class="nav-item-icon"><i class="fal fa-user-circle"></i></span>
					<span class="nav-item-title">지원자관리</span>
				</a>
				<a class="icon-nav-item" href="hr_management.html">
					<span class="nav-item-icon"><i class="fal fa-address-book"></i></span>
					<span class="nav-item-title">추천인재</span>
				</a>
				<a class="icon-nav-item" href="resume_board.html">
					<span class="nav-item-icon"><i class="fal fa-users"></i></span>
					<span class="nav-item-title">인재열람</span>
				</a>
				<a class="icon-nav-item" href="payment_completion_history.html">
					<span class="nav-item-icon"><i class="fal fa-credit-card"></i></span>
					<span class="nav-item-title">결제내역</span>
				</a>
				<a class="icon-nav-item" href="modify_password.html">
					<span class="nav-item-icon"><i class="fal fa-key"></i></span>
					<span class="nav-item-title">비밀번호</span> 
				</a>
				<!-- 비밀번호 변경 또는 찾기 비밀번호와 알림설정 그리고 아래 로그아웃은 한 페이지로 작성, 메뉴는 네비게이션으로 제공-->
				<a class="icon-nav-item" href="user_setting.html">
					<span class="nav-item-icon"><i class="fal fa-bell"></i></span>
					<span class="nav-item-title">알림설정</span> <!-- 메시지 수신 동의 설정-->
				</a>
				<a class="icon-nav-item" href="javaScript:void(0)" onclick="dModal.toast(' 1.카톡플러스친구 연동 2.메일보내기 등으로 검토 ');">
					<span class="nav-item-icon"><i class="fal fa-question-square"></i></span>
					<span class="nav-item-title">고객센터</span> <!-- 카카오톡 플러스 친구 또는 메일 보내기 // 전화는 일단 X-->
				</a>
				<a class="icon-nav-item" href="dentalplus_inform.html">
					<span class="nav-item-icon"><i class="fal fa-info-circle"></i></span>
					<span class="nav-item-title">공지/안내</span> <!-- 공지/안내 -->
				</a>
			</nav>
		</div>
		<div class="panel-body"></div>
		<div class="panel-footer">
			<a class="btn btn-sm" href="javaScript:void(0);" onclick="LOGIN_INFO.logout();"> <span>로그 아웃</span> </a>
		</div>
	</section>
	<section class="dental-cropper" id="dentalCropper">
		<div class="dental-cropper-header">
			<div class="typo-title">영역 선택해서 등록하기</div>
			<button class="d-icon d-close" id="clearBtn"></button>
		</div>
		<div class="dental-cropper-body">
			<div style="margin-left: 5%;">미리보기</div>
			<div style="margin-left: 5%; font-size: 0.5rem; color: #5d5d5d;">원하는 영역을 적절하게 선택해 주세요</div>
			<div class="dental-cropper-preview-container">
				<div class="dental-cropper-preview" id="cropImagePreview"></div>
				<button id="cropBtn" class="btn d-icon d-upload"></button>
				<button id="resetBtn" class="btn d-icon d-refresh"></button>
				<button id="getBtn" class="btn btn-action">GET!</button>
			</div>
			<div class="dental-cropper-img"><img src="" class="target_img" id="cropTarget"></div>
		</div>
	</section>
	<!-- dental need to premium register 모달 -->
	<div class="dental-modal modal" id="regPremiumModal">
		<input type="checkbox" id="dental-modal-reg-premium" name="modal-toggle"> <!-- 모달 체크박스 -->
		<label for="dental-modal-reg-premium"> 프리미엄 회원가입 요청 모달</label> <!-- 모달 체크박스 레이블-->
		<label for="dental-modal-reg-premium"><div class="modal-overlay"></div></label> <!-- 배경, 체크박스로 하면 배경을 레이블로 해서 모달 죽일 수 있음-->
		<div class="modal-overlay-class"></div> <!-- 클래스로 오픈시 배경, 배경 누르면 모달 닫히게 이벤트 걸어야함-->
		<div class="modal-container columns">
			<div class="modal-header">
				<div class="modal-title"> 프리미엄 회원 서비스</div>
				<div class="modal-desc">해당 서비스를 이용하기 위해서 프리미엄 회원가입을 해주세요.</div>
				<label for="dental-modal-reg-premium" rel="dental-modal" title="닫기"><i class="fa fa-window-close"></i></label>
			</div>
			<div class="modal-body">
				<p style="font-size: 0.6rem;">구인 활동이 꾸준하거나 인재풀을 평상시에도 관리하고 싶다면</p>
				<p style="font-size: 1.2rem; font-weight: bold; margin-bottom: 0.5rem;">덴탈플러스 프리미엄회원!</p>
				<div class="btn btn-primary" style="margin-bottom: 0.5rem;">가입하기</div>
				<br>
				1. 합리적인 가격에 pc, 모바일, 앱까지 모두 한번에! 직접 비교해보세요!
				<br>
				2. 추가로, 채용공고 알리기 비용이 50% OFF!
				<br>
				3. 우리 병원 채용공고가 라이브플러스 상단에 노출!
				 <p style="padding-left: 1rem; font-size: 0.5rem;">- 무료회원, 외부 제휴 공고 상위에 노출됩니다.</p>
				 <p style="padding-left: 1rem; font-size: 0.5rem;">- 같은 프리미엄회원의 경우 마감일 기준으로 정렬됩니다.</p>
				<br>
				4. 쉽고 파워풀한 인재풀관리 기능!
				<p style="padding-left: 1rem; font-size: 0.5rem;">- 구직자가 공개한 이력서 열람 및 연락가능</p>
				<p style="padding-left: 1rem; font-size: 0.5rem;">- 우리병원 주소를 관심지역, 우리동네로 설정한 구직자 이력서 열람.</p>
				<p style="padding-left: 1rem; font-size: 0.5rem;">- 우리 병원을 팔로우한 구직자 이력서 열람.</p>
				<p style="padding-left: 1rem; font-size: 0.5rem;">- 우리 병원 채용공고를 스크랩한 구직자 이력서 열람 기능.</p>
				<p style="padding-left: 1rem; font-size: 0.5rem;">- 별도로 관심 인재에 대한 스크랩 기능 지원.</p>
			</div>
			<div class="modal-footer"></div>
		</div>
	</div>
</body>
</html>

<script>

var CROPPER;	
var ResumeManagementApp = (function() {

	var hospitalId;

	function init() {

		if ( !LOGIN_INFO.checkAuthHospital(false) ) return;
		

		var userId = LOGIN_INFO.getId();
        callApi("GET", "/api/user/"+userId+"/hospital/basicInfo/", null,
            function(basicInfo) {
				console.log(basicInfo);

				if ( !basicInfo || !basicInfo.hospitalId ) {
					hospitalId = null;

					document.getElementById("userEmail").innerText = "";
					document.getElementById("hospitalName").innerText  = "";
					document.getElementById("hospitalLogo").src = "";


					alert("병원정보가 등록되어 있지 않습니다. 먼저 병원 정보를 등록하여 주십시오.");
					return;
				}
				

				hospitalId = basicInfo.hospitalId;

                document.getElementById("userEmail").innerText = basicInfo.userEmail;
				document.getElementById("hospitalName").innerText  = basicInfo.hospitalName;
				if ( basicInfo.hasLogoImage ) document.getElementById("hospitalLogo").src = basicInfo.logoImageUrl;


            },
            function(errorCode, errorMsg) {
                alert("에러 [" + errorCode + "] ==> [" + errorMsg + "]");
            }
        );

	}

	init();



	// function onChangeHospitalLogo(event) {
	// 	event.preventDefault();

	// 	console.log("병원 ID : ", hospitalId);

	// 	if ( !hospitalId ) {
	// 		alert("로그인되어 있지 않습니다.");
	// 		return;
	// 	}

	// 	console.log("업로드 대상 : ", this.value);
	// 	var files = event.target.files;
	// 	var filesArr = Array.prototype.slice.call(files);

	// 	filesArr.forEach(function(file) {
	// 		if ( !file.type.match("image.*") ) {
	// 			alert("이미지 파일만 업로드 가능합니다.");
	// 			return;
	// 		}
	// 		console.log("업로드 대상 파일 확인 완료 : ", file);
	// 		console.log("AAA : ", file.name, "   ", file.type);
	// 	});


	// 	var file = files[0];    // 첫번째 파일만 처리
	// 	console.log("업로드할 파일 ", file);
	// 	var formData = new FormData();
	// 	formData.append("file", file);
	// 	console.log("hihihihihi", formData);

	// 	uploadFile("/api/hospital/"+hospitalId+"/logo/", formData,
	// 		function(resData) {
	// 			console.log("파일 업로드 성공 : ", resData);
	// 			document.getElementById("hospitalLogo").src = CONSTANTS.getHospitalLogoImageUrl(LOGIN_INFO.getHospitalId()) + "?" + (Math.random()*1000);
	// 		},
	// 		function(errorCode, errorMsg) {
	// 			alert("병원 로고 이미지 등록에 실패했습니다. [" + errorCode + "]");
	// 		}
	// 	);

	// }

	document.getElementById("uploadHospitalLogo").addEventListener("change", function(e) {

		console.log(e.target.files[0]);
		var cropTarget = document.getElementById("cropTarget");
		cropTarget.src = window.URL.createObjectURL(this.files[0]);

		if ( CROPPER ) {
			console.log( cropTarget.src);
			console.log("replace");
			CROPPER.replace(cropTarget.src);
			dentalCropper.classList.toggle("active");
		} else {
			console.log("new CROPPER");
			CROPPER = new Cropper ( cropTarget, {
				aspectRatio : 150 / 50,
				movable : false,
				preview : document.getElementById("cropImagePreview")
			});

			dentalCropper.classList.toggle("active");

		}
		console.log(CROPPER);
	});

	$("#cropBtn").on("click", function(e) {

		if( !CROPPER ) return dModal.instant("카메라 아이콘을 먼저 선택해주세요.");

		var cropElm = CROPPER.getCroppedCanvas();
		// var cropped = cropElm.toDataURL("image/jpeg", 1.0);

		cropElm.toBlob(function (blob) {
			console.log(blob);
			var url = window.URL.createObjectURL(blob);
			// blob.lastModifiedDate = new Date();
			// blob.name = "profile";

			var formData = new FormData();
			formData.append("file", blob);

			hospitalId= LOGIN_INFO.isHospitalMember() ? LOGIN_INFO.getHospitalId() : "";

			uploadFile("/api/hospital/"+hospitalId+"/logo/", formData,
				function(resData) {
					dModal.instant("병원 로고가 등록되었습니다.");
					console.log("파일 업로드 성공 : ", resData);
					dentalCropper.classList.toggle("active");
					// document.getElementById("hospitalLogo").src = CONSTANTS.getHospitalLogoImageUrl(LOGIN_INFO.getHospitalId()) + "?" + (Math.random()*1000);
					if ( resData ) document.getElementById("hospitalLogo").src = resData + "?" + (Math.random()*1000);
				},
				function(errorCode, errorMsg) {
					alert("병원 로고 이미지 등록에 실패했습니다. [" + errorCode + "]");
					dentalCropper.classList.toggle("active");
				}
			);

			hospitalLogo.onload = function(event) {
				URL.revokeObjectURL(url);
			};

			hospitalLogo.src = url;
		}, 'image/jpeg');

	});

	$("#resetBtn").on("click", function(e) {
		if( !CROPPER ) return dModal.instant("카메라 아이콘을 먼저 선택해주세요.");
		CROPPER.reset();
	});

	$("#clearBtn").on("click", function(e) {
		if( !CROPPER ) return dModal.instant("카메라 아이콘을 먼저 선택해주세요.");
		CROPPER.destroy();
		cropTarget.src = "";
		CROPPER = "";
		dentalCropper.classList.remove("active");
		// uploadHospitalLogo.value= "";
	});

	$("#getBtn").on("click", function(e) {
		if( !CROPPER ) return dModal.instant("카메라 아이콘을 먼저 선택해주세요.");
		var d = CROPPER.getImageData();
		console.log(d);
		dModal.alert(
		"naturalHeight: " + d.naturalHeight 
		+ "\nnaturalWidth: " + d.naturalWidth
		+ "\nheight: " + d.height
		+ "\naspectRatio: " + d.aspectRatio
		+ "\nrotate: " + d.rotate
		);
	});

	document.getElementById("hospitalLogoArea").addEventListener("click", function(e) {
		uploadHospitalLogo.value= "";
		document.getElementById("uploadHospitalLogo").click();
	});

})();
</script>
