<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="robots" content="index, follow">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="author" content="https://github.com/aaa/">
    <title>덴탈플러스</title>
    <link href="css/fontawesome/css/fontawesome-all.css" rel="stylesheet"> <!-- font awesome 5.* pro -->
    <link rel="stylesheet" href="css/dentalBasic.css">

    <script src="js/jquery-1.12.4.min.js"></script>
    <script src="js/handlebars.min.js"></script>
    <script src="js/common.js"></script>
</head>

<body>
    <input id="sidebar" type="checkbox" name="sidebar" hidden>
    <header>
        <div class="main-header navbar">
            <section class="navbar-section">
                <!-- 사이드바 버튼 -->
                <label for="sidebar" class="main-header-icon"><i class="fal fa-bars"></i></label>
            </section>
            <input class="search-checkbox" type="checkbox" id="main-search-checkbox" hidden>
            <section class="navbar-center">
                <!-- 브랜드 로고 -->
                <a class="navbar-brand main-header-brand" href="start.html">Dental+</a>
                <div class="main-search">
                    <input class="main-search-input" type="search" name="main-search" placeholder="키워드 입력">
                    <label class="main-search-submit"><input type=submit hidden><i class="far fa-search"></i></label> <!-- 버튼 방식으로 변경 해야하남? -->
                </div>
                <script>
                    var searchWindow = document.querySelector(".main-search-input");
                    var checkboxForSearch = document.querySelector(".search-checkbox");
                    // 선정우 - 검색창에서 포커스 아웃할 때, 값 없으면 검색창 안보이게 처리, 체크박스로 on/off 하고 있음
                    searchWindow.addEventListener("focusout", function(e) {
                        if (!searchWindow.value) { checkboxForSearch.checked = false; }
                        else { console.log("search keyword: ", searchWindow.value); }
                    });
                </script>
            </section>
            <section class="navbar-section">
                <!-- 사이드바 버튼 -->
                <label for="main-search-checkbox"><span class="main-header-icon"><i class="far fa-search"></i></span></label>
                <a href="user_panel.html" class="main-header-icon"><i class="fal fa-user-alt"></i></a>
                <script>
                    var labelForSearch = document.querySelector(".search-checkbox");
                    labelForSearch.addEventListener("change", function(e) {
                        console.log(searchWindow, this);
                        searchWindow.focus();
                    });
                </script>
            </section>
        </div>
        <div class="header-nav">
            <ul class="header-nav-list">
                <li class="header-nav-item"><a href="liveboard.html">라이브보드</a></li>
                <li class="header-nav-item"><a href="liveboard_local.html">관심 지역</a></li>
                <li class="header-nav-item"><a href="liveboard_home.html">우리 동네</a></li>
                <li class="header-nav-item"><a href="register_resume.html">내 이력서</a></li>
            </ul>
        </div>
    </header>
    <div class="off-canvas">
        <div id="sidebar" class="off-canvas-sidebar">  <!-- 사이드바 -->
            <ul class="menu">
                <li class="menu-item">
                    <div class="tile tile-centered">
                        <div class="tile-icon"><img src="img/avatar-4.png" class="avatar" alt="Avatar"></div>
                        <div class="tile-content">Lee, Juhyun@gmail.com</div>
                    </div>
                </li>
                <li class="divider" data-content="개인회원"></li>
                <li class="menu-item">
                    <div class="menu-badge"><label class="label label-primary">설정하러가기</label></div>
                    <a href="liveboard_local.html">관심 지역</a>
                </li>
                <li class="menu-item">
                    <div class="menu-badge"><span>(채용중/병원수)</span><label class="label label-primary">2/30</label></div>
                    <a href="liveboard_home.html">우리 동네</a>
                </li>
                <li class="menu-item">
                    <div class="menu-badge"><label class="label label-primary">설정하러가기</label></div>
                    <a href="user_interaction.html">관심 병원</a>
                </li>
                <li class="menu-item">
                    <div class="menu-badge"><label class="label label-primary">스크랩없음</label></div>
                    <a href="user_interaction.html">내 스크랩</a>
                </li>
                <li class="menu-item"><a href="register_resume.html">이력서 관리</a></li>
                <li class="divider" data-content="병원회원"></li>
                <li class="menu-item"><a href="register_dentist.html">우리병원 기본 정보</a></li>
                <li class="menu-item"><a href="register_jobad.html">채용공고 등록</a></li>
                <li class="menu-item"><a href="jobAd_interaction.html">채용공고 관리</a></li>
                <li class="menu-item">
                    <div class="menu-badge"><label class="label label-primary">2</label></div>
                    <a href="dentist_panel.html">면접 제안</a>
                </li>
                <li class="menu-item">
                    <div class="menu-badge"><label class="label label-primary">2</label></div>
                    <a href="dentist_panel.html">지원자 관리</a>
                </li>
                <li class="divider"></li>
                <li class="menu-item"><a href="login.html">로그인</a></li>
                <li class="menu-item"><a href="signup.html">회원가입</a></li>
                <li class="menu-item"><a href="start.html">로그아웃</a></li>
                <li class="menu-item"><a href="#menus">설정</a></li>
            </ul>
        </div>
        <label for="sidebar"><div class="off-canvas-overlay"></div></label>   <!-- 메뉴 close -->
    </div>
    <!-- ======================== 공고 속성 선택 BOX ======================== -->
    <!-- 공고 속성 선택 BOX는 다른 것으로 변경될 수 있음 -->
    <section class="liveplus container">
        <input class="local-box-check" type="checkbox" id="liveplus-local-box-check" hidden>
        <div class="liveplus-bar navbar">
            <div class="navbar-section" id="divLiveBoardSidoLabel">
                <label class="liveplus-bar-icon"><i class="fas fa-map-marker-alt"></i></label>
                <ul class="liveplus-breadcrumb">
                    <li class="liveplus-breadcrumb-item" id="locationReset">우리동네</li>     <!-- 여기는 클릭하면, location이 null로 세팅 -->
                    <li class="liveplus-breadcrumb-item" id="currentLocationSidoLabel"></li>    <!-- :empty 사용, 여기는 클릭하면, 선택된 시도 표시 -->
                </ul>
                <div class="liveplus-bar-rbox"><label class="liveplus-bar-icon" for="liveplus-local-box-check"><i class="fas fa-chevron-up"></i></label></div>
            </div>
            <div class="navbar-section">
                <label class="liveplus-bar-icon" for="livefilter-modal">
                    <i class="fas fa-filter"></i>
                    <span>LIVE FILTER <span id="filterChipLength" style="color: #0083cb; font-size: 0.5rem;" data-chip-length="( 전체" > 선택 )</span></span>
                </label>
                <div class="liveplus-bar-rbox">
                    <label class="liveplus-bar-icon" for="livefilter-modal"><i class="fas fa-cog"></i></label>
                </div>
            </div>
        </div>
        <form id="searchForm">
            <div class="dental-modal liveplus-modal" id="jobAdAttrSelector">
                <input type="checkbox" id="livefilter-modal" name="modal-toggle" hidden> <!-- 모달 체크박스 -->
                <input id="livefilter-reset" type="reset" hidden>
                <label for="livefilter-modal"><div class="dental-modal-overlay"></div></label> <!-- 배경, 체크박스로 하면 배경을 레이블로 해서 모달 죽일 수 있음-->
                <div class="dental-modal-container">
                    <div class="modal-container-header">
                        <div class="modal-container-header-title">LIVE Filter</div>
                        <label class="modal-close-label" for="livefilter-modal" rel="dental-modal" title="닫기"><i class="fas fa-window-close"></i></label>
                    </div>
                    <div class="modal-container-body">
                        <!-- 라이브필터만 리셋하게 스크립트 필요 -->
                        <label for="livefilter-reset" title="라이브필터 초기화"><i class="fal fa-sync-alt fa-refresh"></i></label>
                        <fieldset class="livefilter">
                            <div class="filter-title"><i class="fas fa-hospital-o" aria-hidden="true" style="margin-right: 10px;"></i>고용형태</div>
                            <label class="filter-EMP"><input id="attr-EMP"     type="checkbox" name="attr" value=""       data-checkbox-group="EMP"  hidden><span class="chip">전체</span></label>
                            <label class="filter-EMP"><input id="attr-EMP.1"   type="checkbox" name="attr" value="EMP.1"  data-checkbox-group="EMP"  hidden><span class="chip">정규직</span></label>
                            <label class="filter-EMP"><input id="attr-EMP.2"   type="checkbox" name="attr" value="EMP.2"  data-checkbox-group="EMP"  hidden><span class="chip">계약직</span></label>
                            <label class="filter_EMP"><input id="attr-EMP.3"   type="checkbox" name="attr" value="EMP.3"  data-checkbox-group="EMP"  hidden><span class="chip">아르바이트</span></label>
                        </fieldset>
                        <fieldset class="livefilter">
                            <div class="filter-title"><i class="fas fa-medkit" aria-hidden="true" style="margin-right: 10px;" ></i>담당업무</div>
                            <label class="filter-TASK"><input id="attr-TASK"   type="checkbox" name="attr" value=""       data-checkbox-group="TASK" hidden><span class="chip">전체</span></label>
                            <label class="filter-TASK"><input id="attr-TASK.1" type="checkbox" name="attr" value="TASK.1" data-checkbox-group="TASK" hidden><span class="chip">진료실</span></label>
                            <label class="filter-TASK"><input id="attr-TASK.2" type="checkbox" name="attr" value="TASK.2" data-checkbox-group="TASK" hidden><span class="chip">데스크</span></label>
                            <label class="filter-TASK"><input id="attr-TASK.3" type="checkbox" name="attr" value="TASK.3" data-checkbox-group="TASK" hidden><span class="chip">상담</span></label>
                            <label class="filter-TASK"><input id="attr-TASK.4" type="checkbox" name="attr" value="TASK.4" data-checkbox-group="TASK" hidden><span class="chip">보험청구</span></label>
                            <label class="filter-TASK"><input id="attr-TASK.5" type="checkbox" name="attr" value="TASK.5" data-checkbox-group="TASK" hidden><span class="chip">치과내 기공실</span></label>
                            <label class="filter-TASK"><input id="attr-TASK.6" type="checkbox" name="attr" value="TASK.6" data-checkbox-group="TASK" hidden><span class="chip">치과기공소</span></label>
                            <label class="filter-TASK"><input id="attr-TASK.7" type="checkbox" name="attr" value="TASK.7" data-checkbox-group="TASK" hidden><span class="chip">관리 및 경영</span></label>
                            <label class="filter-TASK"><input id="attr-TASK.8" type="checkbox" name="attr" value="TASK.8" data-checkbox-group="TASK" hidden><span class="chip">의사</span></label>
                            <label class="filter-TASK"><input id="attr-TASK.9" type="checkbox" name="attr" value="TASK.9" data-checkbox-group="TASK" hidden><span class="chip">기타</span></label>
                        </fieldset>
                        <fieldset class="livefilter">
                            <div class="filter-title"><i class="fas fa-user-circle" aria-hidden="true" style="margin-right: 10px;"></i>채용부문</div>
                            <label class="filter-AREA"><input id="attr-AREA"   type="checkbox" name="attr" value=""       data-checkbox-group="AREA" hidden><span class="chip">전체</span></label>
                            <label class="filter-AREA"><input id="attr-AREA.1" type="checkbox" name="attr" value="AREA.1" data-checkbox-group="AREA" hidden><span class="chip">치위생사</span></label>
                            <label class="filter-AREA"><input id="attr-AREA.2" type="checkbox" name="attr" value="AREA.2" data-checkbox-group="AREA" hidden><span class="chip">간호조무사</span></label>
                            <label class="filter-AREA"><input id="attr-AREA.3" type="checkbox" name="attr" value="AREA.3" data-checkbox-group="AREA" hidden><span class="chip">치기공사</span></label>
                            <label class="filter-AREA"><input id="attr-AREA.4" type="checkbox" name="attr" value="AREA.4" data-checkbox-group="AREA" hidden><span class="chip">보험청구사</span></label>
                            <label class="filter-AREA"><input id="attr-AREA.5" type="checkbox" name="attr" value="AREA.5" data-checkbox-group="AREA" hidden><span class="chip">코디네이터</span></label>
                            <label class="filter-AREA"><input id="attr-AREA.6" type="checkbox" name="attr" value="AREA.6" data-checkbox-group="AREA" hidden><span class="chip">의사</span></label>
                            <label class="filter-AREA"><input id="attr-AREA.7" type="checkbox" name="attr" value="AREA.7" data-checkbox-group="AREA" hidden><span class="chip">기타</span></label>
                        </fieldset>
                    </div>
                    <div class="modal-container-footer"></div>
                </div>
            </div>
            <script>

                /*
                // 속성 중에서 각 '전체' 버튼들에 대한 이벤트 처리
                function processAttrOnChangeWholeEvent(event, _attrGroupName) {
                    var attrGroupName;
                    if ( _attrGroupName!=undefined && _attrGroupName!=null ) attrGroupName = _attrGroupName;
                    else attrGroupName = this.dataset.attrGroup;
                    console.log("속성 멤버 변경 이벤트 처리 ", attrGroupName);

                    if ( this.checked ) {
                        var attrs = document.querySelectorAll("input[type=checkbox][name='attr'][data-checkbox-group='" + attrGroupName + "']:not([value=''])");
                        attrs.forEach(function(el) {
                            el.checked = false;
                        });
                    }

                    renderAttrChips();
                    $("#searchForm").submit();
                }
                document.querySelectorAll("input[type=checkbox][name='attr'][value='']").forEach(function(element) {
                    element.addEventListener("change", processAttrOnChangeWholeEvent);
                });
                

                // 속성 중에서 각 '전체'가 아닌 버튼들에 대한 이벤트 처리
                function processAttrOnChangeMembersEvent(event, _attrGroupName) {
                    var attrGroupName;
                    if ( _attrGroupName!=undefined && _attrGroupName!=null ) attrGroupName = _attrGroupName;
                    else attrGroupName = this.dataset.attrGroup;
                    console.log("속성 멤버 변경 이벤트 처리 ", attrGroupName);

                    // 갯수를 구한다.
                    var attrs = document.querySelectorAll("input[type=checkbox][name='attr'][data-checkbox-group='" + attrGroupName + "']:not([value=''])");
                    var totalAttrCount = attrs.length;

                    var checkedAttrCount = document.querySelectorAll("input[type=checkbox][name='attr'][data-checkbox-group='" + attrGroupName + "']:not([value='']):checked").length;

                    if ( totalAttrCount==checkedAttrCount ) {   // 모두 check되었다면, '전체'를 check &'개별'들은 모두 uncheck.
                        document.querySelector("input[type=checkbox][name='attr'][data-checkbox-group='" + attrGroupName + "'][value='']").checked = true;
                        attrs.forEach(function(el) {
                            el.checked = false;
                        });

                    } else if ( checkedAttrCount>0 ) {          // 하나라도 checked인 것이 있으면, '전체'를 uncheck
                        document.querySelector("input[type=checkbox][name='attr'][data-checkbox-group='" + attrGroupName + "'][value='']").checked = false;
                    
                    } else if ( checkedAttrCount==0 ) {
                        document.querySelector("input[type=checkbox][name='attr'][data-checkbox-group='" + attrGroupName + "'][value='']").checked = true;                        
                    }

                    renderAttrChips();
                    $("#searchForm").submit();
                    //searchForm.submit();
                    //document.getElementById("searchForm").submit();
                    
                }
                document.querySelectorAll("input[type=checkbox][name='attr']:not([value=''])").forEach(function(element) {
                    element.addEventListener("change", processAttrOnChangeMembersEvent);
                });

                */

                // 선택된 속성에 대한 chip을 생성한다.
                // function showAttrChip(element) {
                //     if ( element.checked ) {
                //         $(".livefilter-chip .chip[for='" + element.id + "']").show();
                //     } else {
                //         $(".livefilter-chip .chip[for='" + element.id + "']").hide();
                //     }
                // } 
                function renderAttrChips() {
                    var allAttrs = document.querySelectorAll("input[type=checkbox][name='attr']:not([value=''])"); // parent 를 캐쉬해놓고 하면 더 나을 듯
                    var allAttrsChecked = document.querySelectorAll("input[type=checkbox][name='attr']:checked:not([value=''])"); // 선정우,
                    var livepusFooter = document.getElementById("liveplusFooter"); // 선정우, 할 필요 없지만 안해놓으면 아래 헷갈릴까봐 변수 선언.
                    var filterChipLengthElm = document.getElementById("filterChipLength"); // 선정우
                    //allAttrs.forEach(showAttrChip(element, index));
                    allAttrs.forEach(function(element) {
                        if ( element.checked ) {
                            $(".livefilter-chip .chip[for='" + element.id + "']").show(); 
                            liveplusFooter.style.display = "block"; // 선정우 한땀 땄음
                        } else {
                            $(".livefilter-chip .chip[for='" + element.id + "']").hide();
                            if ( !allAttrsChecked.length ) { 
                                livepusFooter.removeAttribute("style"); // 선정우, 체크된 개별-전체 제외-칩이 0이면 푸터 박스 안보이게 합니다.
                                filterChipLengthElm.dataset.chipLength = "( 전체"; // 선정우가 한땀 땄음
                            } else {
                                filterChipLengthElm.dataset.chipLength = "( " + allAttrsChecked.length + " 개"; // 선정우 한땀 땄음
                            }
                        }
                    });
                }

                function afterChangedAttrCheckboxes() {
                    renderAttrChips();
                    $("#searchForm").submit();
                }

                var checkboxGroup = new DynamicCheckboxGroup(document.getElementById("searchForm"), "attr", afterChangedAttrCheckboxes);
                checkboxGroup.check();  // 초기값 세팅 (지금은 모두 '전체'로)


                // 지역 변경 시 submit 처리
                // function processLocationOnChangeEvent(event) {
                //     searchForm.submit();
                // }
                // document.getElementsByName("location").forEach(function(element) {
                //     element.addEventListener("change", processLocationOnChangeEvent);
                // });                
                $(".liveplus").on("click", "input[name=location]", function(e) {
                    $("#searchForm").submit();
                });

                // 초기로딩 처리
                // processAttrOnChangeMembersEvent(null, "EMP");
                // processAttrOnChangeMembersEvent(null, "TASK");
                // processAttrOnChangeMembersEvent(null, "AREA");



                // // 초기 로드시 기 선택된 속성(attr)에 대한 칩을 화면에 표시
                // $(".liveplus input[name=attr]").each(function(idx, el) {
                //     console.log("attr에 속성 적용 : ", el.id, " ", el.checked);
                //     if (el.checked) {
                //         // $(".livefilter-chip .chip[for=" + el.id + "]").fadeIn();
                //         $(".livefilter-chip .chip[for=" + el.id + "]").show();
                //     } else {
                //         //$(".livefilter-chip .chip[for=" + el.id + "]").hide();
                //     }
                // });

                // // 속성(attr) 선택 시, 칩 보이기/숨기기, submit 처리
                // $(".liveplus").on("change", "input[name=attr]", function(e) {
                //     console.log("attr 눌렀음 : liveplus click input[name=attr] ", this);

                //     // A. 칩 보이기/숨기기 처리
                //     if (this.checked == true) {
                //         $(".livefilter-chip .chip[for=" + this.id + "]").show();
                //     } else {
                //         $(".livefilter-chip .chip[for=" + this.id + "]").hide();
                //     }

                //     // B. 리프레쉬 아이콘 초기화
                //     $(".fa-refresh").removeAttr("style"); // 리프레쉬 아이콘 초기화

                //     // C. submit 처리
                //     $("#searchForm").submit();
                // });

                /*
                // 속성(attr) 선택 시, 리프레쉬 아이콘 초기화
                $(".liveplus").on("click", "input[type=attr]", function(e) {
                    console.log("뭔가 누름 : checkbox인 것 .liveplus --> click --> input[type=checkbox] ", this);
                    $(".fa-refresh").removeAttr("style");
                });
                */
                // 리프레쉬 아이콘 클릭했을 때, 회전 효과 및 칩 숨기기(초기화), submit
                $(".liveplus").on("click", ".fa-refresh", function(e) {
                    // A. 아이콘 회전
                    $(this).css({
                        "transform": "rotate(360deg)",
                        "transition": "all 0.5s ease"
                    });
                    console.log("리프레쉬 아이콘 클릭 fa-refresh :   .liveplus --> click --> .fa-refresh ", this);

                    // B. 칩 전체 숨기기 (초기화)
                    $(".livefilter-chip .chip").hide();
                    
                    // C. submit 처리
                    $("#searchForm").submit();

                    // 선정우, Footer 필터 칩 박스 숨기기
                    liveplusFooter.style.display = "none";
                    filterChipLength.dataset.chipLength = "( 전체"; // 선정우가 한땀 땄음, 위에 renderAttr~~ 함수랑 통합해야할 듯 ㅠ
                });
            </script>
            <!-- ======================== 지역 선택 BOX ======================== -->
            <div class="local-box" id="" style="height: 400px;">
                <p>지도</p>
                <p>전체 병원수: 49개</p>
                <p>구인 병원: 20개</p>
                <p>구인 중 병원을 확인하고 문의할 수 있습니다.</p>
                <p>등록 공고: 9개</p>
            </div>
        </form>
        <!-- 체크박스로 푸터 박스 on/off 할 수 있음, 지금은 그냥 스크립트로 되어 있음 -->
        <input class="liveplus-footer-check" type="checkbox" id="" hidden>
        <div class="liveplus-footer" id="liveplusFooter" hidden>
            <div class="livefilter-chip">
                    <label class="filter-EMP chip" for="attr-EMP.1" style="display: none;">정규직<span class="btn btn-clear"></span></label>
                    <label class="filter-EMP chip" for="attr-EMP.2" style="display: none;">계약직<span class="btn btn-clear"></span></label>
                    <label class="filter-EMP chip" for="attr-EMP.3" style="display: none;">아르바이트<span class="btn btn-clear"></span></label>
        
                    <label class="filter-TASK chip" for="attr-TASK.1" style="display: none;">진료실<span class="btn btn-clear"></span></label>
                    <label class="filter-TASK chip" for="attr-TASK.2" style="display: none;">데스크<span class="btn btn-clear"></span></label>
                    <label class="filter-TASK chip" for="attr-TASK.3" style="display: none;">상담<span class="btn btn-clear"></span></label>
                    <label class="filter-TASK chip" for="attr-TASK.4" style="display: none;">보험청구실<span class="btn btn-clear"></span></label>
                    <label class="filter-TASK chip" for="attr-TASK.5" style="display: none;">치과내 기공실<span class="btn btn-clear"></span></label>
                    <label class="filter-TASK chip" for="attr-TASK.6" style="display: none;">치과기공소<span class="btn btn-clear"></span></label>
                    <label class="filter-TASK chip" for="attr-TASK.7" style="display: none;">관리 및 경영<span class="btn btn-clear"></span></label>
                    <label class="filter-TASK chip" for="attr-TASK.8" style="display: none;">의사<span class="btn btn-clear"></span></label>
                    <label class="filter-TASK chip" for="attr-TASK.9" style="display: none;">기타<span class="btn btn-clear"></span></label>
        
                    <label class="filter-AREA chip" for="attr-AREA.1" style="display: none;">치위생사<span class="btn btn-clear"></span></label>
                    <label class="filter-AREA chip" for="attr-AREA.2" style="display: none;">간호조무사<span class="btn btn-clear"></span></label>
                    <label class="filter-AREA chip" for="attr-AREA.3" style="display: none;">치기공사<span class="btn btn-clear"></span></label>
                    <label class="filter-AREA chip" for="attr-AREA.4" style="display: none;">보험청구사<span class="btn btn-clear"></span></label>
                    <label class="filter-AREA chip" for="attr-AREA.5" style="display: none;">코디네이터<span class="btn btn-clear"></span></label>
                    <label class="filter-AREA chip" for="attr-AREA.6" style="display: none;">의사<span class="btn btn-clear"></span></label>
                    <label class="filter-AREA chip" for="attr-AREA.7" style="display: none;">기타<span class="btn btn-clear"></span></label>
            </div>
            <div class="livefilter-box"><label for="livefilter-reset" title="라이브필터 초기화"><i class="fal fa-sync-alt fa-refresh"></i></label></div>
        </div>
    </section>
    <!-- ======================== 프리미어 공고 ======================== -->
    <section id="section-premiereAds" class="premiere-ad">
        <div class="jobpost-list-bar">
            <span class="typo-title2">프리미어 채용정보</span>
            <span class="jobpost-list-bar-counter" id="countOfPremierAds">0</span>
        </div>

        <div class="premiere-ad-box columns" id="premierJobAdsList"></div>
        <script id="premierJobAdsTemplate" type="text/x-handlebars-template">
            {{#each .}}
            <a href="jobad.html?jobAdId={{id}}" class="column col-6 card">
                <div class="card-image"><img src="/resources/hospital/{{logoUrl}}" class="img-responsive"></div>
                <div class="card-header">
                    <div class="card-title">{{hospitalName}}</div>
                    <div class="card-subtitle">{{title}}</div>
                </div>
                <div class="card-body">
                    <div class="dental-info">
                        <span class="info-detail">{{renderLocationOfJobAdCard siguCode}}</span>
                        <!-- 시도, 시구군 정보 -->
                        <span class="info-detail txt-red"> 12 / 26 (화) </span>
                        <!-- 마감날짜 -->
                    </div>
                    <div class="dental-info">
                        <span class="info-detail">
                            <span>치위생사</span>
                            <span>치기공사</span>
                            <i></i>
                        </span>
                        <!-- 채용부문 -->
                        <span class="info-detail">
                            <span>진료실</span>
                            <span>상담</span>
                            <i></i>
                        </span>
                        <!-- 채용업무 -->
                    </div>
                </div>
                <label class="companyScrap"><input type="checkbox" name="scrap" value="{{id}}" hidden><span class="scrapIcon" title="관심 공고를 스크랩하세요!"></span></label>
            </a>
            {{/each}}
        </script>
    </section>
    
    <!-- ======================== 일반 공고 ======================== -->
    <section id="section-generalAds" class="jobpost-list">
        <div class="jobpost-list-bar">
            <span class="typo-title2">라이브 채용정보</span>
            <span class="jobpost-list-bar-counter" id="countOfGeneralAds">0</span>
        </div>
        <div class="jobpost-list-body" id="generalJobAdsList"></div>
        <script id="generalJobAdsTemplate" type="text/x-handlebars-template">
            {{#each .}}
            <div class="jobpost-list-card">
                <a href="jobad.html?jobAdId={{id}}">
                    <div class="jobpost-list-card-header">
                        <div class="jobpost-list-card-title">{{hospitalName}}</div>
                        <div class="jobpost-list-card-subtitle">{{title}}</div>
                    </div>
                    <div class="jobpost-list-card-body">
                        <div class="dental-info">
                            <span class="info-detail" style="font-weight: bold; color: #212529">{{renderLocationOfJobAdCard locationCode}}</span>
                            <span class="info-detail subway-line">
                                <span class="subway102"><i></i></span> <!-- 지하철 작업하면서 클래스 대신 data-tag 로 변경 필요, 검토해주세욧 -->
                                <span class="subway117"><i></i></span> <!-- 'span.info-detail' 하위에 span 이 3개 이상이면 i 태그에 "외" 삽입됨 -->
                                <span>서울 3호선<i></i></span> <!-- 3개부터는 안보임, css 로 display:none 처리 -->
                                <span class="subway120"><i></i></span> <!-- 텍스트가 들어오면 그냥 텍스트로 노출됨, 노출되는 개수 등 그 외 로직은 그대로 적용-->
                            </span>
                            <!-- 시도, 시구군 정보, 교통정보 -->
                            <span class="info-detail">
                                {{#each hashTag}}
                                    <span>#{{.}}<i></i></span>
                                {{/each}}
                            </span>
                            <!-- 주변 핫플레이스 -->
                        </div>
                        <div class="dental-info">
                            <!-- 기존 코드 : 서버 생성 시
                            {{#each attrGroup}}
                                <span class="info-detail">
                                    {{#each attrList}}
                                    <span>{{codeName}}</span>
                                    {{/each}}
                                    <i></i>
                                </span>
                            {{/each}}
                            -->
                            {{{renderAttrOnCard attr}}}

                            <span class="info-detail">{{hiringEndDate}} ({{hiringEndDateDay}})</span>
                            <!-- <span class="info-detail">12 / 26 (화)</span> -->
                            <!-- 마감날짜 -->
                        </div>
                    </div>
                </a>
                <div class="jobpost-list-card-footer">
                    <!-- a 태그 추가하고 클래스 단순하게 정리 해야함 -->
                    <span class="footer-item"><label><input type="checkbox" name="scrap" value="{{id}}" hidden><i class="fa fa-star"></i>스크랩</label></span>
                    <span class="footer-item" data-action="apply" data-action-value="{{id}}"><i class="fa fa-share"></i>바로지원</span>
                    <span class="footer-item" data-action="call"  data-action-value="{{id}}"><i class="fa fa-phone"></i>전화문의</span>
                </div>
            </div>
            
            {{/each}}
        </script>
    </section>
    <!-- loading spinner, 'active' 클래스로 활성화 -->
    <div class="dental-loading" id="loadingModal" hidden>
        <div class="fa-icon"><i class="fa fa-spinner fa-pulse fa-3x fa-fw"></i></div>
        <div class="loading-overlay" hidden></div>
    </div>
</body>
</html>

<script>

var LiveBoardApp = (function() {

    Handlebars.registerHelper("renderLocation", function(code) {
        return LOCATION_CODE.getName(code);
    });




    var currentSidoCode = null;                 // 현재 선택된 시도코드 또는 현재 선택된 시구들의 시도코드


    /******************************************************************************/
    /* <ul class="liveplus-breadcrumb breadcrumb"> 영역 처리
    /*
    /*
    /******************************************************************************/

    // '전체'를 클릭한 경우에, 지역 선택을 reset한다.
    document.getElementById("locationReset").addEventListener("click", function(event) {

        // 선택된 지역(location)을 초기화한다.
        var locationCheckboxes = document.querySelectorAll("input[type=checkbox][name='location']:checked");        
        locationCheckboxes.forEach(function(element) {
            element.checked = false;
        });

        // 시도코드도 초기화한다.
        currentSidoCode = null;

        $("#searchForm").submit();
    });
    

    // 전체 > 'XXX' : 현재 선택된 시도 코드 이름을 생성하여 화면에 출력한다.
    function setCurrentLocationSidoLabel() {

        console.log("** setCurrentLocationSidoLabel() currentSidoCode:" + currentSidoCode);
        if ( currentSidoCode != null ) {
            document.getElementById("currentLocationSidoLabel").innerHTML = LOCATION_CODE.getName(currentSidoCode);
        
            // 해당 시도를 클릭할 때.
            document.getElementById("currentLocationSidoLabel").addEventListener('click', function(event) {
                //currentSidoCode = 

                // 전체 location들을 초기화.  currentSidoCode는 현재 값으로 그대로.
                var locationCheckboxes = document.querySelectorAll("input[type=checkbox][name='location']:checked");        
                locationCheckboxes.forEach(function(element) {
                    element.checked = false;
                });

                //$("#searchForm").submit();
                searchForm.submit();
            });
            

        } else {
            document.getElementById("currentLocationSidoLabel").innerHTML = "";
        }
    }




    const GENERAL_JOB_ADS_PER_PAGE = 10;        // 스크롤 사이즈 (한 페이지에서 보여질 아이템 개수)
    var SCROLL_LOCK = false;                    // 페이지 스크롤 LOCK

    var totalCountOfGeneralJobAds = 0;          // 전체 일반 공고 개수
    var lastPageNo = 1;                         // 최근 조회 페이지
    var lastQueryString;                        // 최종 Query String



    /******************************************************************************/
    /*  프리미어 공고 로딩 및 출력
    /*  
    /*******************************************************************************/
    var premierJobAdsTemplate = $("#premierJobAdsTemplate").html();

    function listPremierJobAds(_queryParamString) {

        var searchParam = "adType=1&pageSize=5&" + _queryParamString; // 프리미어 광고 유형 추가
        console.log("listPremierJobAds : searchParam:", searchParam);
        callApi("GET", "/api/jobAd/", searchParam,
            function(jobAdList) {
                var itemList = Handlebars.compile(premierJobAdsTemplate)(jobAdList);
                $('#premierJobAdsList').html(itemList);
            },
            function(errorCode, errorMsg) {
                console.log("에러 1 [" + errorCode + "] ==> [" + errorMsg + "]");
                alert("에러 1 [" + errorCode + "] ==> [" + errorMsg + "]");
            }
        );
    }



    /******************************************************************************/
    /*  일반 공고 로딩 및 출력
    /*  
    /*******************************************************************************/
    var generalJobAdsTemplate = $("#generalJobAdsTemplate").html();

    function listGeneralJobAds(_pageNo, _queryParamString) {

        if (SCROLL_LOCK) {
            console.log("SCROLL LOCKED - in JS");
            setTimeout(function() {
                SCROLL_LOCK = false;
                console.log("listJobAds:SCROLL_LOCK 풀렸음");
            }, 500);
            return;
        }
        SCROLL_LOCK = true;


        console.log('listGeneralJobAds CALLED. _pageNo:', _pageNo);
        if (_pageNo == null) pageNo = 1;
        else pageNo = _pageNo;

        //var searchParam = searchCondition.toQueryString(pageNo);
        var searchParam = "pageNo=" + pageNo + "&" + _queryParamString;
        console.log("searchParam:", searchParam);
        callApi("GET", "/api/jobAd/", searchParam,
            function(jobAdList) {
                lastPageNo = pageNo; // 최근 페이지 번호를 변경한다.

                //console.log(generalJobAdsTemplate);
                //var template  = Handlebars.compile(generalJobAdsTemplate);
                var itemList = Handlebars.compile(generalJobAdsTemplate)(jobAdList);

                if (pageNo != null && pageNo > 1) $('#generalJobAdsList').append(itemList);
                else $('#generalJobAdsList').html(itemList);


                // 스크랩된 공고에 별표시
                var scrappedJobAdIds = LOGIN_INFO.getScrappedJobAdIds();
                if ( scrappedJobAdIds!=null ) {
                    scrappedJobAdIds.forEach(function(jobAdId) {
                        document.querySelectorAll("input[type=checkbox][name='scrap'][value='" + jobAdId + "']").forEach(function(element) {
                            element.checked = true;
                        });
                    });
                }


                SCROLL_LOCK = false;
            },
            function(errorCode, errorMsg) {
                console.log("에러 1 [" + errorCode + "] ==> [" + errorMsg + "]");
                alert("에러 1 [" + errorCode + "] ==> [" + errorMsg + "]");
                SCROLL_LOCK = false;
            }
        );

    }
    /******************************************************************************/
    /*  스크롤했을 때, 일반 공고에 대한 append 처리
    /*  
    /*******************************************************************************/
    $(window).scroll(function() {
        if (totalCountOfGeneralJobAds == 0) return;

        var maxPageNo = totalCountOfGeneralJobAds / GENERAL_JOB_ADS_PER_PAGE + 1; // 한 페이지에 10개의 목록 지정 (개수 조정 시 변경 필요)
        if ((lastPageNo + 1) >= maxPageNo) return;

        if (SCROLL_LOCK) {
            console.log("SCROLL : LOCKED");
            setTimeout(function() {
                SCROLL_LOCK = false;
                console.log("SCROLL_LOCK 풀렸음");
            }, 500);
            return;
        }

        if (Math.ceil($(window).scrollTop()) >= ($(document).height() - $(window).height() * 3)) {
            listGeneralJobAds(lastPageNo + 1, lastQueryString);
        }
    });


    /******************************************************************************/
    /*  검색 처리
    /*  
    /*******************************************************************************/
    function search(queryParamString) {
        console.log("검색 : ", queryParamString);
        lastQueryString = queryParamString;


        // 화면에 로딩 창 보여준다.

        // 먼저 지역 dash panel 생성  locationSelector
        // callApi("GET", "/api/jobAd/dash2/", queryParamString,
        callApi("GET", "/api/jobAd/dashboard/", queryParamString,
            function(resData) {

                var htmlStr = '';

                var requestedSidoCodeArray = [];
                if ( resData.requestedLocationCodeList != null ) {
                    resData.requestedLocationCodeList.forEach(function(locCode) {
                        requestedSidoCodeArray.push(locCode);
                    });
                }
                console.log("요청된 시도코드 : ", requestedSidoCodeArray);
                


                resData.jobAdGroupList.forEach(function(item) {

                    // 약간 문제 있다. 만약에 시도코드가 다른 location이 여러 개 있는 경우에는 마지막 값으로 설정될 것. 현재는 다른 시도의 시구들을 선택할 수 없어서 ...
                    // if ( LOCATION_CODE.isSiguCode(item.locationCode) ) {
                    //     currentSidoCode = LOCATION_CODE.extractSidoCode(item.locationCode);
                    // }

                    
                    
                    var onRequestedLocation = "";
                    if (item.requested != null && item.requested == true)   onRequestedLocation = " checked='true' ";
                    else    onRequestedLocation = "";
                    
                    //console.log(item);
                    htmlStr += `<label class="col-3"><input type="checkbox" name="location" value="${item.locationCode}" hidden ${onRequestedLocation}><div><span>${item.locationName}</span><span>${item.cnt}</span></div></label>`;
                    

                });
                $("#locationSelector").html(htmlStr);

                totalCountOfGeneralJobAds = resData.requestedCnt;
                $("#countOfGeneralAds").html(resData.requestedCnt);

                setCurrentLocationSidoLabel();
            },
            function(errorCode, errorMsg) {
                alert("에러 [" + errorCode + "] ==> [" + errorMsg + "]");
            }
        );

        // 프리미어 공고 리스트 업데이트
        listPremierJobAds(queryParamString);
        // 공고 리스트 업데이트
        listGeneralJobAds(1, queryParamString);
    }


    
    /*******************************************************************************/
    /*  검색 조건 변경 시의 이벤트 처리
    /*******************************************************************************/

    // form이 변경되었을 때, 이에 대한 이벤트 처리
    // reset인 경우에는 change 이벤트가 적용되지 않아서(확인 필요), reset에 대한 별도 핸들러가 필요한 것으로 판단됨
    $("#searchCondition").on("change", "form", function(e) {
        console.log("searchCondition에 change event 발생");
        //console.log("change 이벤트 ==> ", $(this).serialize() );
        processSubmit(this);
    });


    /******************************************************************************/
    /*  submit에 대한 후킹 처리
    /*  서버사이드 제너레이션인 경우에는 이 이벤트 핸들러 주석 처리
    /*******************************************************************************/
    $("#searchForm").submit(function(e) {
        e.preventDefault();
        //console.log("후킹 : ", this);
        processSubmit(this);
    });

    /*******************************************************************************/
    /*  submit을 ajax처리로 변환 및 history 관리
    /*******************************************************************************/
    function processSubmit(form) {
        

        var action = form.action; // FORM의 action
        var paramString = $(form).serialize(); // FORM의 Query Parameters

        // currentSidoCode
        var checkedLocations = document.querySelectorAll("input[type=checkbox][name='location']:checked");
        if ( checkedLocations.length==0 && currentSidoCode != null ) {
            paramString += "&location=" + currentSidoCode;
        } 
        
        console.log("submit 대체 ", action, " params=", paramString);

        search(paramString);

        // paramString이 기존과 동일한 값이 아니라면, history 처리한다.
    }



    /******************************************************************************/
    /*  페이지가 로드된 직후에 실행됨.
    /*  검색엔진에 노출되기 위하여 GET 방식 처리를 수행함
    /*******************************************************************************/
    function initPage() {
        //setCurrentLocationSidoLabel();

        var arr = (document.location + '').split('?');
        console.log("페이지 요청 URL : ", arr);
        if (arr.length == 1) { // 파라미터 없이 직접 호출된 경우
            search();
        } else if (arr.length == 2) { // 파라미터와 함께 호출된 경우
            search(arr[1]);
        } else { // 파라미터 시작인 '?'가 2개 이상인 경우
            console.log("ERROR : 페이지 호출 시 '?'가 2개 이상임.");
            return;
            // search();
        }
    }



    /******************************************************************************/
    /*  현재 페이지 초기화 수행
    /*  
    /*******************************************************************************/
    initPage();



    
    /******************************************************************************/
    /*  스크랩 처리
    /*  
    /*******************************************************************************/
    $("#generalJobAdsList").on("click", "input[type=checkbox][name=scrap]", function(e) { // 값이 change되는 것을 막기 위해서 click으로 이벤트 건다
        if (!LOGIN_INFO.isLoggedIn()) {
            e.preventDefault();
            alert("스크랩을 위해서는 로그인이 필요합니다.");
            return;
        }

        console.log("일반 공고 스크랩 ", this.value , "  ==> ", this.checked);
        if ( this.checked ) {
            LOGIN_INFO.addScrappedJobAdId(this.value);
        } else {
            LOGIN_INFO.removeScrappedJobAdId(this.value);
        }



        // 서버에 스크랩으로 등록/삭제될 JobAd의 ID들을 송신
        // 응답은 현재의 등록된 JobAd의 ID들이 수신된다.
        // querySelector로 프리미어 공고 및 일반 공고 중에서 해당 ID를 가진 것의 별표표시를 다시 해준다.

        //LOGIN_INFO.addScrappedJobAdId(this.value);

    });



    

})();
</script>